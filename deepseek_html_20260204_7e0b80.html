<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite City Academy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-blue: #1a365d;
            --secondary-blue: #2d4e8a;
            --accent-gold: #d4af37;
            --light-bg: #f5f7fa;
            --success: #38a169;
            --danger: #e53e3e;
            --warning: #d69e2e;
            --admin-red: #c53030;
            --teacher-blue: #3182ce;
            --student-green: #38a169;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .header {
            background-color: var(--primary-blue);
            color: white;
            padding: 1.2rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2.2rem;
            color: var(--accent-gold);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--accent-gold);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .nav-links a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-blue);
        }

        /* Main Content Container */
        .container {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .login-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            padding: 2.5rem;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h2 {
            color: var(--primary-blue);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: #666;
        }

        .role-selector {
            display: flex;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .role-option {
            flex: 1;
            text-align: center;
            padding: 0.8rem;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .role-option.active {
            background-color: var(--primary-blue);
            color: white;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--secondary-blue);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
        }

        .login-footer {
            text-align: center;
            margin-top: 1.5rem;
            color: #666;
        }

        .login-footer a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }

        /* Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard-header h2 {
            color: var(--primary-blue);
            font-size: 1.8rem;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .admin .card-icon {
            background-color: rgba(197, 48, 48, 0.1);
            color: var(--admin-red);
        }

        .teacher .card-icon {
            background-color: rgba(49, 130, 206, 0.1);
            color: var(--teacher-blue);
        }

        .student .card-icon {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--student-green);
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }

        .card-text {
            color: #666;
            font-size: 0.9rem;
        }

        /* Table Styles */
        .table-container {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .table-header h3 {
            color: var(--primary-blue);
            font-size: 1.4rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--primary-blue);
            border-bottom: 2px solid #e9ecef;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background-color: rgba(214, 158, 46, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--danger);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--primary-blue);
            font-size: 1.5rem;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Form Row */
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* Gallery Styles */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .gallery-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .gallery-caption {
            padding: 1rem;
            background-color: white;
        }

        .gallery-caption h4 {
            margin-bottom: 0.5rem;
            color: var(--primary-blue);
        }

        /* Footer Styles */
        .footer {
            background-color: var(--primary-blue);
            color: white;
            padding: 2rem;
            text-align: center;
            margin-top: 2rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1.5rem 0;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
        }

        .copyright {
            margin-top: 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .nav-links {
                gap: 1rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }

        /* Role-specific backgrounds */
        .admin-bg {
            background-color: rgba(197, 48, 48, 0.05);
        }

        .teacher-bg {
            background-color: rgba(49, 130, 206, 0.05);
        }

        .student-bg {
            background-color: rgba(56, 161, 105, 0.05);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Payment status */
        .payment-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.paid {
            background-color: var(--success);
        }

        .status-dot.pending {
            background-color: var(--warning);
        }

        .status-dot.overdue {
            background-color: var(--danger);
        }

        /* Google Meet Integration */
        .meet-container {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }

        .meet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .meet-code {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.2rem;
            margin: 1rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .alert-success {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background-color: rgba(229, 62, 62, 0.1);
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        .alert-warning {
            background-color: rgba(214, 158, 46, 0.1);
            color: var(--warning);
            border-left: 4px solid var(--warning);
        }
        
        /* Ghana Cedis Symbol */
        .currency {
            font-family: Arial, sans-serif;
        }
        
        /* Report Card Styles */
        .report-card {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--primary-blue);
        }
        
        .report-header h3 {
            color: var(--primary-blue);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .student-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.3rem;
        }
        
        .info-value {
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .grade-table {
            width: 100%;
            margin-bottom: 2rem;
        }
        
        .grade-table th {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .grade-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .grade-score {
            font-weight: bold;
        }
        
        .grade-A { color: var(--success); }
        .grade-B { color: #4299e1; }
        .grade-C { color: var(--warning); }
        .grade-D { color: #ed8936; }
        .grade-F { color: var(--danger); }
        
        .grade-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .summary-card {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .summary-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .teacher-comments {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .teacher-comments h4 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }
        
        .comment-box {
            background-color: white;
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid var(--teacher-blue);
            margin-bottom: 1rem;
        }
        
        .comment-subject {
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }
        
        .comment-text {
            color: #555;
            line-height: 1.5;
        }
        
        .comment-teacher {
            text-align: right;
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        /* Print button for report card */
        .print-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Grade Input Styles */
        .grade-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .grade-input {
            width: 80px;
            text-align: center;
        }
        
        .grade-select {
            width: 100px;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 10px;
            background-color: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--success);
            transition: width 0.3s;
        }
        
        /* Academic Year Selector */
        .academic-year-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }
        
        .academic-year-selector label {
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .academic-year-selector select {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        /* Term Selector */
        .term-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .term-btn {
            padding: 0.5rem 1rem;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .term-btn.active {
            background-color: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <h1>Elite City <span>Academy</span></h1>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="#" id="homeLink">Home</a>
            <a href="#" id="aboutLink">About</a>
            <a href="#" id="contactLink">Contact</a>
        </div>
        <div class="user-info" id="userInfo">
            <div class="user-avatar" id="userAvatar">U</div>
            <div id="userName">Guest</div>
        </div>
    </header>

    <!-- Main Content Container -->
    <div class="container" id="mainContainer">
        <!-- Login Page (Default View) -->
        <div id="loginPage" class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <h2>Welcome to Elite City Academy</h2>
                    <p>Please select your role and login to continue</p>
                </div>
                
                <div class="role-selector">
                    <div class="role-option active" data-role="student">Student</div>
                    <div class="role-option" data-role="teacher">Teacher</div>
                    <div class="role-option" data-role="admin">Admin</div>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Username/Email</label>
                        <input type="text" id="username" class="form-control" placeholder="Enter your username or email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>Don't have an account? <a href="#" id="signupLink">Sign up here</a></p>
                </div>
            </div>
        </div>

        <!-- Signup Page -->
        <div id="signupPage" class="login-container" style="display: none;">
            <div class="login-box">
                <div class="login-header">
                    <h2>Create Account</h2>
                    <p>Join Elite City Academy as a student or teacher</p>
                </div>
                
                <div class="role-selector" id="signupRoleSelector">
                    <div class="role-option active" data-role="student">Student</div>
                    <div class="role-option" data-role="teacher">Teacher</div>
                </div>
                
                <form id="signupForm">
                    <!-- Student Signup Form -->
                    <div id="studentSignupForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="studentFirstname">First Name</label>
                                <input type="text" id="studentFirstname" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="studentSurname">Surname</label>
                                <input type="text" id="studentSurname" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="studentDob">Date of Birth</label>
                                <input type="date" id="studentDob" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="studentClass">Class</label>
                                <select id="studentClass" class="form-control" required>
                                    <option value="">Select Class</option>
                                    <option value="Form 1">Form 1</option>
                                    <option value="Form 2">Form 2</option>
                                    <option value="Form 3">Form 3</option>
                                    <option value="Form 4">Form 4</option>
                                    <option value="Form 5">Form 5</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentContact">Contact Number</label>
                            <input type="tel" id="studentContact" class="form-control" placeholder="+233 XX XXX XXXX" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentResidence">Residence</label>
                            <input type="text" id="studentResidence" class="form-control" placeholder="Enter your residential address" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentEmail">Email Address</label>
                            <input type="email" id="studentEmail" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="studentPassword">Password</label>
                            <input type="password" id="studentPassword" class="form-control" required>
                        </div>
                    </div>
                    
                    <!-- Teacher Signup Form -->
                    <div id="teacherSignupForm" style="display: none;">
                        <div class="form-group">
                            <label for="teacherName">Full Name</label>
                            <input type="text" id="teacherName" class="form-control" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="teacherSubject">Subject/Class</label>
                                <input type="text" id="teacherSubject" class="form-control" placeholder="e.g. Mathematics, Form 3" required>
                            </div>
                            <div class="form-group">
                                <label for="teacherDob">Date of Birth</label>
                                <input type="date" id="teacherDob" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="teacherResidence">Residence</label>
                            <input type="text" id="teacherResidence" class="form-control" placeholder="Enter your residential address" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="teacherContact">Contact Number</label>
                                <input type="tel" id="teacherContact" class="form-control" placeholder="+233 XX XXX XXXX" required>
                            </div>
                            <div class="form-group">
                                <label for="teacherSsnit">SSNIT Number</label>
                                <input type="text" id="teacherSsnit" class="form-control" placeholder="SSNXXXXXXXX" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="teacherQualification">Qualification</label>
                            <input type="text" id="teacherQualification" class="form-control" placeholder="e.g. B.Ed Mathematics" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="teacherEmail">Email Address</label>
                                <input type="email" id="teacherEmail" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="teacherPassword">Password</label>
                            <input type="password" id="teacherPassword" class="form-control" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>Already have an account? <a href="#" id="backToLoginLink">Login here</a></p>
                </div>
            </div>
        </div>

        <!-- Student Dashboard -->
        <div id="studentDashboard" class="student-bg" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-user-graduate"></i> Student Dashboard</h2>
                <button class="btn btn-warning" id="studentLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <!-- Welcome Alert -->
            <div class="alert alert-success" id="studentWelcomeAlert">
                <i class="fas fa-check-circle"></i>
                <div>
                    <strong>Welcome back, <span id="studentWelcomeName">Student</span>!</strong>
                    <p>You have <span id="studentAssignmentCount">2</span> pending assignments and <span id="studentPaymentStatus">1</span> payment due.</p>
                </div>
            </div>
            
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="card-value" id="studentClassInfo">Form 3</div>
                    <div class="card-title">Current Class</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="card-value">85%</div>
                    <div class="card-title">Attendance Rate</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="card-value" id="studentAverageGrade">B+</div>
                    <div class="card-title">Average Grade</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-money-check-alt"></i>
                    </div>
                    <div class="card-value currency" id="studentBalance">GHâ‚µ350</div>
                    <div class="card-title">Balance Due</div>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="classes">Classes</div>
                <div class="tab" data-tab="payments">Payments</div>
                <div class="tab" data-tab="assignments">Assignments</div>
                <div class="tab" data-tab="reportCard">Report Card</div>
            </div>
            
            <!-- Classes Tab -->
            <div class="tab-content active" id="classesTab">
                <div class="meet-container">
                    <div class="meet-header">
                        <h3><i class="fas fa-video"></i> Virtual Classroom</h3>
                        <button class="btn btn-success" id="joinClassBtn">
                            <i class="fas fa-video"></i> Join Class Now
                        </button>
                    </div>
                    
                    <p>Join your scheduled classes using Google Meet. Click the button above to join your current class session.</p>
                    
                    <div class="meet-code">
                        <span>Meeting Code: <strong>elite-city-<span id="meetCode">xyz-abcd-123</span></strong></span>
                        <button class="btn btn-sm btn-primary" id="copyMeetCodeBtn">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    
                    <h4 style="margin-top: 1.5rem;">Today's Schedule</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Subject</th>
                                    <th>Teacher</th>
                                    <th>Link</th>
                                </tr>
                            </thead>
                            <tbody id="studentScheduleTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Payments Tab -->
            <div class="tab-content" id="paymentsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-money-check-alt"></i> Payment History</h3>
                        <div class="payment-status">
                            <div class="status-dot pending"></div>
                            <span>Pending: <strong id="pendingPayments">1</strong></span>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Receipt No.</th>
                            </tr>
                        </thead>
                        <tbody id="studentPaymentsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Assignments Tab -->
            <div class="tab-content" id="assignmentsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-tasks"></i> Assignments</h3>
                        <span>Due: <strong id="dueAssignments">2</strong></span>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Assignment</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="studentAssignmentsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Report Card Tab -->
            <div class="tab-content" id="reportCardTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-file-alt"></i> Academic Report Card</h3>
                        <div class="academic-year-selector">
                            <label for="studentAcademicYear">Academic Year:</label>
                            <select id="studentAcademicYear" class="form-control">
                                <option value="2023/2024">2023/2024</option>
                                <option value="2022/2023">2022/2023</option>
                                <option value="2021/2022">2021/2022</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="term-selector">
                        <button class="term-btn active" data-term="Term 1">Term 1</button>
                        <button class="term-btn" data-term="Term 2">Term 2</button>
                        <button class="term-btn" data-term="Term 3">Term 3</button>
                        <button class="term-btn" data-term="Annual">Annual</button>
                    </div>
                    
                    <div id="studentReportCardContainer">
                        <!-- Report card will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Dashboard -->
        <div id="teacherDashboard" class="teacher-bg" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-chalkboard-teacher"></i> Teacher Dashboard</h2>
                <button class="btn btn-warning" id="teacherLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="card-value" id="teacherStudentCount">24</div>
                    <div class="card-title">Total Students</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="card-value" id="teacherSubjectCount">3</div>
                    <div class="card-title">Subjects</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="card-value" id="teacherAssignmentCount">5</div>
                    <div class="card-title">Assignments Due</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="card-value" id="teacherGradesPending">12</div>
                    <div class="card-title">Grades Pending</div>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="teacherClasses">My Classes</div>
                <div class="tab" data-tab="teacherStudents">Students</div>
                <div class="tab" data-tab="teacherAssignments">Assignments</div>
                <div class="tab" data-tab="teacherGrades">Grade Management</div>
            </div>
            
            <!-- Classes Tab -->
            <div class="tab-content active" id="teacherClassesTab">
                <div class="meet-container">
                    <div class="meet-header">
                        <h3><i class="fas fa-video"></i> Virtual Classroom</h3>
                        <div>
                            <button class="btn btn-success" id="startClassBtn">
                                <i class="fas fa-play-circle"></i> Start Class
                            </button>
                            <button class="btn btn-primary" id="scheduleClassBtn">
                                <i class="fas fa-calendar-plus"></i> Schedule
                            </button>
                        </div>
                    </div>
                    
                    <p>Start a virtual class session or schedule one for later. Share the meeting code with your students.</p>
                    
                    <div class="meet-code">
                        <span>Your Meeting Code: <strong>elite-teacher-<span id="teacherMeetCode">abc-1234</span></strong></span>
                        <button class="btn btn-sm btn-primary" id="copyTeacherMeetCodeBtn">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    
                    <h4 style="margin-top: 1.5rem;">Scheduled Classes</h4>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Class</th>
                                    <th>Subject</th>
                                    <th>Students</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="teacherClassesTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Students Tab -->
            <div class="tab-content" id="teacherStudentsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-users"></i> My Students</h3>
                        <button class="btn btn-success" id="sendMessageToStudentsBtn">
                            <i class="fas fa-envelope"></i> Send Message
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Contact</th>
                                <th>Performance</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="teacherStudentsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Assignments Tab -->
            <div class="tab-content" id="teacherAssignmentsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-tasks"></i> Assignments Management</h3>
                        <button class="btn btn-success" id="createAssignmentBtn">
                            <i class="fas fa-plus"></i> Create Assignment
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Assignment</th>
                                <th>Class</th>
                                <th>Due Date</th>
                                <th>Submitted</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="teacherAssignmentsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Grade Management Tab -->
            <div class="tab-content" id="teacherGradesTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-chart-bar"></i> Grade Management</h3>
                        <div class="academic-year-selector">
                            <label for="teacherAcademicYear">Academic Year:</label>
                            <select id="teacherAcademicYear" class="form-control">
                                <option value="2023/2024">2023/2024</option>
                                <option value="2022/2023">2022/2023</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="term-selector" style="margin-bottom: 1.5rem;">
                        <button class="term-btn active" data-term="Term 1">Term 1</button>
                        <button class="term-btn" data-term="Term 2">Term 2</button>
                        <button class="term-btn" data-term="Term 3">Term 3</button>
                    </div>
                    
                    <div class="form-row" style="margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label for="gradeClassSelect">Select Class</label>
                            <select id="gradeClassSelect" class="form-control">
                                <option value="">Select Class</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gradeSubjectSelect">Select Subject</label>
                            <select id="gradeSubjectSelect" class="form-control">
                                <option value="">Select Subject</option>
                            </select>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn btn-primary" id="loadStudentsForGradingBtn">
                                <i class="fas fa-users"></i> Load Students
                            </button>
                        </div>
                    </div>
                    
                    <div id="gradeEntryTableContainer" style="display: none;">
                        <h4 style="margin-bottom: 1rem;">Enter Grades for <span id="gradingSubject">Subject</span> - <span id="gradingClass">Class</span></h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Student Name</th>
                                    <th>Class Test (20%)</th>
                                    <th>Mid-Term (30%)</th>
                                    <th>Exam (50%)</th>
                                    <th>Total (100%)</th>
                                    <th>Grade</th>
                                    <th>Comments</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="gradeEntryTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                        <div style="margin-top: 1rem; text-align: right;">
                            <button class="btn btn-success" id="saveAllGradesBtn">
                                <i class="fas fa-save"></i> Save All Grades
                            </button>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 2rem;">Previously Entered Grades</h4>
                    <table style="margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Class</th>
                                <th>Term</th>
                                <th>Students Graded</th>
                                <th>Last Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teacherGradesHistoryTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="admin-bg" style="display: none;">
            <div class="dashboard-header">
                <h2><i class="fas fa-cogs"></i> Admin Dashboard</h2>
                <button class="btn btn-warning" id="adminLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="card-value" id="adminTotalStudents">0</div>
                    <div class="card-title">Total Students</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="card-value" id="adminTotalTeachers">0</div>
                    <div class="card-title">Total Teachers</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="card-value currency" id="adminTotalRevenue">GHâ‚µ0</div>
                    <div class="card-title">Total Revenue</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="card-value" id="adminReportCards">0</div>
                    <div class="card-title">Report Cards</div>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="adminUsers">User Management</div>
                <div class="tab" data-tab="adminPayments">Payment System</div>
                <div class="tab" data-tab="adminGallery">School Gallery</div>
                <div class="tab" data-tab="adminEvents">Events</div>
                <div class="tab" data-tab="adminSMS">SMS System</div>
                <div class="tab" data-tab="adminReports">Academic Reports</div>
            </div>
            
            <!-- User Management Tab -->
            <div class="tab-content active" id="adminUsersTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-user-cog"></i> User Management</h3>
                        <div>
                            <button class="btn btn-success" id="addStudentBtn">
                                <i class="fas fa-user-plus"></i> Add Student
                            </button>
                            <button class="btn btn-primary" id="addTeacherBtn">
                                <i class="fas fa-chalkboard-teacher"></i> Add Teacher
                            </button>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 1rem;">Students</h4>
                    <table style="margin-bottom: 2rem;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Contact</th>
                                <th>Residence</th>
                                <th>Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminStudentsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                    
                    <h4 style="margin-bottom: 1rem;">Teachers</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Subject</th>
                                <th>Contact</th>
                                <th>Qualification</th>
                                <th>SSNIT No.</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminTeachersTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Payment System Tab -->
            <div class="tab-content" id="adminPaymentsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-money-check-alt"></i> Payment Management (Admin Only)</h3>
                        <button class="btn btn-success" id="recordPaymentBtn">
                            <i class="fas fa-plus-circle"></i> Record Payment
                        </button>
                    </div>
                    
                    <div id="paymentEntryForm" style="display: none; margin-bottom: 2rem; background-color: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                        <h4 style="margin-bottom: 1rem; color: var(--primary-blue);">Enter New Payment</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="paymentStudentSelect">Select Student</label>
                                <select id="paymentStudentSelect" class="form-control">
                                    <option value="">Select Student</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="paymentAmount">Amount (GHâ‚µ)</label>
                                <input type="number" id="paymentAmount" class="form-control" placeholder="Enter amount in Ghana Cedis" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="paymentType">Payment Type</label>
                                <select id="paymentType" class="form-control">
                                    <option value="School Fees">School Fees</option>
                                    <option value="Books">Books</option>
                                    <option value="Uniform">Uniform</option>
                                    <option value="Exam Fees">Exam Fees</option>
                                    <option value="Sports Levy">Sports Levy</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="paymentDate">Payment Date</label>
                                <input type="date" id="paymentDate" class="form-control" value="">
                            </div>
                            <div class="form-group">
                                <label for="paymentTerm">Term</label>
                                <select id="paymentTerm" class="form-control">
                                    <option value="Term 1">Term 1</option>
                                    <option value="Term 2">Term 2</option>
                                    <option value="Term 3">Term 3</option>
                                    <option value="Full Year">Full Year</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="paymentStatus">Status</label>
                                <select id="paymentStatus" class="form-control">
                                    <option value="Paid">Paid</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Partial">Partial</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="paymentDescription">Description (Optional)</label>
                            <textarea id="paymentDescription" class="form-control" rows="2" placeholder="Additional payment details"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button class="btn btn-danger" id="cancelPaymentBtn">Cancel</button>
                            <button class="btn btn-success" id="savePaymentBtn">
                                <i class="fas fa-check"></i> Save Payment
                            </button>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 1.5rem; margin-bottom: 1rem;">Payment Records</h4>
                    <div class="form-row" style="margin-bottom: 1rem;">
                        <div class="form-group">
                            <label for="filterStudent">Filter by Student</label>
                            <select id="filterStudent" class="form-control">
                                <option value="">All Students</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterStatus">Filter by Status</label>
                            <select id="filterStatus" class="form-control">
                                <option value="">All Status</option>
                                <option value="Paid">Paid</option>
                                <option value="Pending">Pending</option>
                                <option value="Partial">Partial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterTerm">Filter by Term</label>
                            <select id="filterTerm" class="form-control">
                                <option value="">All Terms</option>
                                <option value="Term 1">Term 1</option>
                                <option value="Term 2">Term 2</option>
                                <option value="Term 3">Term 3</option>
                                <option value="Full Year">Full Year</option>
                            </select>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Student</th>
                                <th>Description</th>
                                <th>Term</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Receipt No.</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminPaymentsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Gallery Tab -->
            <div class="tab-content" id="adminGalleryTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-images"></i> School Gallery</h3>
                        <button class="btn btn-success" id="addGalleryImageBtn">
                            <i class="fas fa-plus"></i> Add Image
                        </button>
                    </div>
                    
                    <div class="gallery-grid" id="galleryGrid">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Events Tab -->
            <div class="tab-content" id="adminEventsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-calendar-alt"></i> Events Management</h3>
                        <button class="btn btn-success" id="addEventBtn">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Audience</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminEventsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- SMS System Tab -->
            <div class="tab-content" id="adminSMSTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-sms"></i> SMS Messaging System</h3>
                        <span class="badge badge-success">SMS Credits: <strong id="smsCredits">100</strong></span>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="smsRecipient">Recipient(s)</label>
                        <select id="smsRecipient" class="form-control">
                            <option value="all_students">All Students</option>
                            <option value="all_teachers">All Teachers</option>
                            <option value="all_parents">All Parents</option>
                            <option value="specific_class">Specific Class</option>
                            <option value="specific">Specific Student/Teacher</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="specificClassContainer" style="display: none; margin-bottom: 1.5rem;">
                        <label for="specificClass">Select Class</label>
                        <select id="specificClass" class="form-control">
                            <option value="">Select Class</option>
                            <option value="Form 1">Form 1</option>
                            <option value="Form 2">Form 2</option>
                            <option value="Form 3">Form 3</option>
                            <option value="Form 4">Form 4</option>
                            <option value="Form 5">Form 5</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="specificRecipientContainer" style="display: none; margin-bottom: 1.5rem;">
                        <label for="specificRecipient">Select Student/Teacher</label>
                        <select id="specificRecipient" class="form-control">
                            <option value="">Select User</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="smsMessage">Message</label>
                        <textarea id="smsMessage" class="form-control" rows="4" placeholder="Enter your message here... (Max 160 characters)"></textarea>
                        <div style="text-align: right; margin-top: 0.5rem;">
                            <span id="smsCharCount">0</span>/160 characters
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="smsTemplate">Use Template (Optional)</label>
                        <select id="smsTemplate" class="form-control">
                            <option value="">Select Template</option>
                            <option value="fees_reminder">Fees Reminder</option>
                            <option value="event_notification">Event Notification</option>
                            <option value="assignment_reminder">Assignment Reminder</option>
                            <option value="emergency">Emergency Alert</option>
                            <option value="report_card">Report Card Notification</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" id="sendSMSBtn" style="width: 100%;">
                        <i class="fas fa-paper-plane"></i> Send SMS Message
                    </button>
                    
                    <h4 style="margin-top: 2rem;">SMS History</h4>
                    <table style="margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Recipient</th>
                                <th>Message</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="smsHistoryTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Academic Reports Tab -->
            <div class="tab-content" id="adminReportsTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-graduation-cap"></i> Academic Reports Management</h3>
                        <div class="academic-year-selector">
                            <label for="adminAcademicYear">Academic Year:</label>
                            <select id="adminAcademicYear" class="form-control">
                                <option value="2023/2024">2023/2024</option>
                                <option value="2022/2023">2022/2023</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row" style="margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label for="adminReportClass">Select Class</label>
                            <select id="adminReportClass" class="form-control">
                                <option value="">All Classes</option>
                                <option value="Form 1">Form 1</option>
                                <option value="Form 2">Form 2</option>
                                <option value="Form 3">Form 3</option>
                                <option value="Form 4">Form 4</option>
                                <option value="Form 5">Form 5</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="adminReportTerm">Select Term</label>
                            <select id="adminReportTerm" class="form-control">
                                <option value="">All Terms</option>
                                <option value="Term 1">Term 1</option>
                                <option value="Term 2">Term 2</option>
                                <option value="Term 3">Term 3</option>
                                <option value="Annual">Annual</option>
                            </select>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn btn-primary" id="filterReportsBtn">
                                <i class="fas fa-filter"></i> Filter Reports
                            </button>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Class</th>
                                <th>Term</th>
                                <th>Average Grade</th>
                                <th>Position</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminReportsTable">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 2rem; padding: 1.5rem; background-color: #f8f9fa; border-radius: 8px;">
                        <h4 style="margin-bottom: 1rem;">Generate Report Cards</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="generateClass">Class</label>
                                <select id="generateClass" class="form-control">
                                    <option value="">Select Class</option>
                                    <option value="Form 1">Form 1</option>
                                    <option value="Form 2">Form 2</option>
                                    <option value="Form 3">Form 3</option>
                                    <option value="Form 4">Form 4</option>
                                    <option value="Form 5">Form 5</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="generateTerm">Term</label>
                                <select id="generateTerm" class="form-control">
                                    <option value="Term 1">Term 1</option>
                                    <option value="Term 2">Term 2</option>
                                    <option value="Term 3">Term 3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="generateAcademicYear">Academic Year</label>
                                <select id="generateAcademicYear" class="form-control">
                                    <option value="2023/2024">2023/2024</option>
                                    <option value="2022/2023">2022/2023</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button class="btn btn-success" id="generateReportsBtn">
                                    <i class="fas fa-file-pdf"></i> Generate Report Cards
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for Adding/Editing Users -->
        <div id="userModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="userModalTitle">Add User</h3>
                    <button class="close-modal" id="closeUserModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="userModalForm">
                        <input type="hidden" id="modalUserId">
                        <input type="hidden" id="modalUserType">
                        
                        <div id="studentModalForm" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="modalFirstname">First Name</label>
                                    <input type="text" id="modalFirstname" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="modalSurname">Surname</label>
                                    <input type="text" id="modalSurname" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="modalDob">Date of Birth</label>
                                    <input type="date" id="modalDob" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="modalClass">Class</label>
                                    <select id="modalClass" class="form-control" required>
                                        <option value="">Select Class</option>
                                        <option value="Form 1">Form 1</option>
                                        <option value="Form 2">Form 2</option>
                                        <option value="Form 3">Form 3</option>
                                        <option value="Form 4">Form 4</option>
                                        <option value="Form 5">Form 5</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalContact">Contact Number</label>
                                <input type="tel" id="modalContact" class="form-control" placeholder="+233 XX XXX XXXX" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalResidence">Residence</label>
                                <input type="text" id="modalResidence" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalEmail">Email Address</label>
                                <input type="email" id="modalEmail" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalParentContact">Parent Contact (Optional)</label>
                                <input type="tel" id="modalParentContact" class="form-control" placeholder="+233 XX XXX XXXX">
                            </div>
                        </div>
                        
                        <div id="teacherModalForm" style="display: none;">
                            <div class="form-group">
                                <label for="modalTeacherName">Full Name</label>
                                <input type="text" id="modalTeacherName" class="form-control" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="modalTeacherSubject">Subject/Class</label>
                                    <input type="text" id="modalTeacherSubject" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="modalTeacherDob">Date of Birth</label>
                                    <input type="date" id="modalTeacherDob" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalTeacherResidence">Residence</label>
                                <input type="text" id="modalTeacherResidence" class="form-control" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="modalTeacherContact">Contact Number</label>
                                    <input type="tel" id="modalTeacherContact" class="form-control" placeholder="+233 XX XXX XXXX" required>
                                </div>
                                <div class="form-group">
                                    <label for="modalTeacherSsnit">SSNIT Number</label>
                                    <input type="text" id="modalTeacherSsnit" class="form-control" placeholder="SSNXXXXXXXX" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalTeacherQualification">Qualification</label>
                                <input type="text" id="modalTeacherQualification" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="modalTeacherEmail">Email Address</label>
                                <input type="email" id="modalTeacherEmail" class="form-control" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="deleteUserBtn" style="display: none;">Delete User</button>
                    <button class="btn btn-primary" id="saveUserBtn">Save User</button>
                </div>
            </div>
        </div>

        <!-- Modal for Adding Gallery Images -->
        <div id="galleryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Gallery Image</h3>
                    <button class="close-modal" id="closeGalleryModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="galleryImageTitle">Image Title</label>
                        <input type="text" id="galleryImageTitle" class="form-control" placeholder="Enter image title">
                    </div>
                    
                    <div class="form-group">
                        <label for="galleryImageCategory">Category</label>
                        <select id="galleryImageCategory" class="form-control">
                            <option value="School Events">School Events</option>
                            <option value="Class Activities">Class Activities</option>
                            <option value="Sports">Sports</option>
                            <option value="Awards">Awards</option>
                            <option value="Infrastructure">Infrastructure</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="galleryImageDescription">Description</label>
                        <textarea id="galleryImageDescription" class="form-control" rows="3" placeholder="Enter image description"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="galleryImageUrl">Image URL</label>
                        <input type="text" id="galleryImageUrl" class="form-control" placeholder="Enter image URL">
                        <small>Note: For demonstration, enter a URL to an image. In a real system, you would upload the image.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="saveGalleryImageBtn">Add Image</button>
                </div>
            </div>
        </div>

        <!-- Modal for Adding Events -->
        <div id="eventModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add School Event</h3>
                    <button class="close-modal" id="closeEventModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="eventTitle">Event Title</label>
                        <input type="text" id="eventTitle" class="form-control" placeholder="Enter event title">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventDate">Event Date</label>
                            <input type="date" id="eventDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="eventTime">Event Time</label>
                            <input type="time" id="eventTime" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventDescription">Description</label>
                        <textarea id="eventDescription" class="form-control" rows="4" placeholder="Enter event description"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventAudience">Audience</label>
                        <select id="eventAudience" class="form-control">
                            <option value="All">All (Students, Teachers, Parents)</option>
                            <option value="Students Only">Students Only</option>
                            <option value="Teachers Only">Teachers Only</option>
                            <option value="Parents Only">Parents Only</option>
                            <option value="Specific Class">Specific Class</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="saveEventBtn">Add Event</button>
                </div>
            </div>
        </div>
        
        <!-- Modal for Entering Grades -->
        <div id="gradeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Enter Grades for <span id="modalStudentName">Student</span></h3>
                    <button class="close-modal" id="closeGradeModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="gradeModalForm">
                        <input type="hidden" id="modalGradeStudentId">
                        <input type="hidden" id="modalGradeSubject">
                        <input type="hidden" id="modalGradeClass">
                        <input type="hidden" id="modalGradeTerm">
                        <input type="hidden" id="modalGradeAcademicYear">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="modalClassTest">Class Test (20%)</label>
                                <input type="number" id="modalClassTest" class="form-control" min="0" max="20" step="0.5" placeholder="0-20">
                            </div>
                            <div class="form-group">
                                <label for="modalMidTerm">Mid-Term (30%)</label>
                                <input type="number" id="modalMidTerm" class="form-control" min="0" max="30" step="0.5" placeholder="0-30">
                            </div>
                            <div class="form-group">
                                <label for="modalExam">Exam (50%)</label>
                                <input type="number" id="modalExam" class="form-control" min="0" max="50" step="0.5" placeholder="0-50">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="modalTotalScore">Total Score (100%)</label>
                                <input type="number" id="modalTotalScore" class="form-control" readonly>
                            </div>
                            <div class="form-group">
                                <label for="modalGrade">Grade</label>
                                <select id="modalGrade" class="form-control">
                                    <option value="">Select Grade</option>
                                    <option value="A">A (80-100%)</option>
                                    <option value="B">B (70-79%)</option>
                                    <option value="C">C (60-69%)</option>
                                    <option value="D">D (50-59%)</option>
                                    <option value="F">F (0-49%)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="modalPosition">Class Position</label>
                                <input type="number" id="modalPosition" class="form-control" min="1" placeholder="e.g., 1, 2, 3">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalComments">Teacher Comments</label>
                            <textarea id="modalComments" class="form-control" rows="3" placeholder="Enter comments about student performance"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="saveGradeBtn">Save Grade</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h2>Elite City <span>Academy</span></h2>
            </div>
            <p>Excellence in Education Since 2005</p>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Contact Us</a>
                <a href="#">Careers</a>
            </div>
            <div class="copyright">
                &copy; 2023 Elite City Academy. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data storage
            initializeData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Show login page by default
            showLoginPage();
            
            // Set today's date for payment date field
            document.getElementById('paymentDate').valueAsDate = new Date();
        });

        // Data storage for the application
        let appData = {
            currentUser: null,
            currentRole: null,
            students: [],
            teachers: [],
            payments: [],
            gallery: [],
            events: [],
            smsHistory: [],
            assignments: [],
            classes: [],
            academicRecords: [],
            feeStructure: {
                "Form 1": { tuition: 1200, books: 300, uniform: 200, total: 1700 },
                "Form 2": { tuition: 1300, books: 350, uniform: 200, total: 1850 },
                "Form 3": { tuition: 1400, books: 400, uniform: 200, total: 2000 },
                "Form 4": { tuition: 1500, books: 450, uniform: 200, total: 2150 },
                "Form 5": { tuition: 1600, books: 500, uniform: 200, total: 2300 }
            },
            subjects: [
                "Mathematics", "English Language", "Integrated Science", "Social Studies",
                "French", "ICT", "Religious & Moral Education", "Physical Education",
                "Geography", "History", "Economics", "Biology", "Chemistry", "Physics",
                "Further Mathematics", "Literature in English", "Government", "Accounting",
                "Business Studies", "Agricultural Science"
            ]
        };

        // Initialize sample data
        function initializeData() {
            // Check if data exists in localStorage
            const savedData = localStorage.getItem('eliteCityAcademyData');
            
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                // Create sample data
                appData.students = [
                    {
                        id: 1,
                        firstname: "John",
                        surname: "Doe",
                        fullName: "John Doe",
                        dob: "2008-05-15",
                        class: "Form 3",
                        contact: "+233 24 123 4567",
                        residence: "East Legon, Accra",
                        email: "john.doe@elite.edu",
                        password: "student123",
                        status: "Active",
                        balance: 350,
                        parentContact: "+233 20 987 6543"
                    },
                    {
                        id: 2,
                        firstname: "Jane",
                        surname: "Smith",
                        fullName: "Jane Smith",
                        dob: "2009-08-22",
                        class: "Form 2",
                        contact: "+233 54 987 6543",
                        residence: "Dansoman, Accra",
                        email: "jane.smith@elite.edu",
                        password: "student123",
                        status: "Active",
                        balance: 0,
                        parentContact: "+233 24 555 6677"
                    },
                    {
                        id: 3,
                        firstname: "Kwame",
                        surname: "Amponsah",
                        fullName: "Kwame Amponsah",
                        dob: "2007-11-10",
                        class: "Form 4",
                        contact: "+233 50 111 2233",
                        residence: "Tema, Accra",
                        email: "kwame.amponsah@elite.edu",
                        password: "student123",
                        status: "Active",
                        balance: 1200,
                        parentContact: "+233 26 444 5566"
                    }
                ];
                
                appData.teachers = [
                    {
                        id: 1,
                        name: "Dr. Kwame Mensah",
                        subject: "Mathematics, Form 3",
                        dob: "1980-03-10",
                        residence: "Labone, Accra",
                        contact: "+233 20 123 4567",
                        qualification: "Ph.D. Mathematics",
                        ssnit: "SSN1234567",
                        email: "kwame.mensah@elite.edu",
                        password: "teacher123",
                        status: "Active"
                    },
                    {
                        id: 2,
                        name: "Mrs. Ama Serwaa",
                        subject: "English Language, Form 2",
                        dob: "1985-11-05",
                        residence: "Cantonments, Accra",
                        contact: "+233 27 987 6543",
                        qualification: "M.Ed. English",
                        ssnit: "SSN7654321",
                        email: "ama.serwaa@elite.edu",
                        password: "teacher123",
                        status: "Active"
                    },
                    {
                        id: 3,
                        name: "Mr. Kofi Asante",
                        subject: "Science, Form 4",
                        dob: "1975-07-20",
                        residence: "Adenta, Accra",
                        contact: "+233 54 333 4444",
                        qualification: "M.Sc. Chemistry",
                        ssnit: "SSN8888999",
                        email: "kofi.asante@elite.edu",
                        password: "teacher123",
                        status: "Active"
                    }
                ];
                
                appData.payments = [
                    {
                        id: 1,
                        studentId: 1,
                        studentName: "John Doe",
                        date: "2023-09-15",
                        description: "School Fees - Term 1",
                        term: "Term 1",
                        amount: 500,
                        status: "Paid",
                        receiptNo: "REC00123"
                    },
                    {
                        id: 2,
                        studentId: 1,
                        studentName: "John Doe",
                        date: "2023-09-20",
                        description: "Books",
                        term: "Term 1",
                        amount: 150,
                        status: "Pending",
                        receiptNo: "REC00124"
                    },
                    {
                        id: 3,
                        studentId: 2,
                        studentName: "Jane Smith",
                        date: "2023-09-10",
                        description: "School Fees - Term 1",
                        term: "Term 1",
                        amount: 500,
                        status: "Paid",
                        receiptNo: "REC00122"
                    },
                    {
                        id: 4,
                        studentId: 3,
                        studentName: "Kwame Amponsah",
                        date: "2023-09-05",
                        description: "School Fees - Term 1 (Partial)",
                        term: "Term 1",
                        amount: 750,
                        status: "Partial",
                        receiptNo: "REC00120"
                    }
                ];
                
                appData.gallery = [
                    {
                        id: 1,
                        title: "Graduation Ceremony 2023",
                        category: "School Events",
                        description: "Our graduating class of 2023",
                        imageUrl: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80"
                    },
                    {
                        id: 2,
                        title: "Science Fair Winners",
                        category: "Awards",
                        description: "Students showcasing their science projects",
                        imageUrl: "https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80"
                    },
                    {
                        id: 3,
                        title: "Sports Day 2023",
                        category: "Sports",
                        description: "Annual inter-house sports competition",
                        imageUrl: "https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80"
                    }
                ];
                
                appData.events = [
                    {
                        id: 1,
                        title: "Parents-Teacher Meeting",
                        date: "2023-10-15",
                        time: "10:00 AM",
                        description: "Quarterly meeting with parents to discuss student progress",
                        audience: "All",
                        status: "Upcoming"
                    },
                    {
                        id: 2,
                        title: "Science Exhibition",
                        date: "2023-10-25",
                        time: "9:00 AM",
                        description: "Annual science exhibition showcasing student projects",
                        audience: "Students Only",
                        status: "Upcoming"
                    },
                    {
                        id: 3,
                        title: "Career Day",
                        date: "2023-11-05",
                        time: "8:30 AM",
                        description: "Professionals from various fields share career insights with students",
                        audience: "Students Only",
                        status: "Upcoming"
                    }
                ];
                
                appData.assignments = [
                    {
                        id: 1,
                        title: "Mathematics: Algebra Problems",
                        subject: "Mathematics",
                        class: "Form 3",
                        dueDate: "2023-10-05",
                        assignedBy: "Dr. Kwame Mensah",
                        status: "Pending",
                        studentId: 1
                    },
                    {
                        id: 2,
                        title: "English Essay",
                        subject: "English Language",
                        class: "Form 2",
                        dueDate: "2023-10-10",
                        assignedBy: "Mrs. Ama Serwaa",
                        status: "Pending",
                        studentId: 2
                    },
                    {
                        id: 3,
                        title: "Chemistry Lab Report",
                        subject: "Science",
                        class: "Form 4",
                        dueDate: "2023-10-08",
                        assignedBy: "Mr. Kofi Asante",
                        status: "Pending",
                        studentId: 3
                    }
                ];
                
                appData.classes = [
                    {
                        id: 1,
                        subject: "Mathematics",
                        class: "Form 3",
                        teacher: "Dr. Kwame Mensah",
                        time: "9:00 AM - 10:30 AM",
                        meetCode: "elite-math-123",
                        day: "Monday, Wednesday, Friday"
                    },
                    {
                        id: 2,
                        subject: "English Language",
                        class: "Form 2",
                        teacher: "Mrs. Ama Serwaa",
                        time: "11:00 AM - 12:30 PM",
                        meetCode: "elite-english-456",
                        day: "Tuesday, Thursday"
                    },
                    {
                        id: 3,
                        subject: "Science",
                        class: "Form 4",
                        teacher: "Mr. Kofi Asante",
                        time: "1:00 PM - 2:30 PM",
                        meetCode: "elite-science-789",
                        day: "Monday, Wednesday"
                    }
                ];
                
                appData.smsHistory = [
                    {
                        id: 1,
                        date: "2023-09-25",
                        recipient: "All Students",
                        message: "Reminder: School fees payment deadline is October 5th.",
                        status: "Delivered"
                    },
                    {
                        id: 2,
                        date: "2023-09-20",
                        recipient: "All Teachers",
                        message: "Staff meeting tomorrow at 3:00 PM in the conference room.",
                        status: "Delivered"
                    },
                    {
                        id: 3,
                        date: "2023-09-15",
                        recipient: "Form 4 Parents",
                        message: "Parent-teacher meeting scheduled for October 10th. Please confirm attendance.",
                        status: "Delivered"
                    }
                ];
                
                // Sample academic records
                appData.academicRecords = [
                    {
                        id: 1,
                        studentId: 1,
                        studentName: "John Doe",
                        class: "Form 3",
                        subject: "Mathematics",
                        teacherId: 1,
                        teacherName: "Dr. Kwame Mensah",
                        academicYear: "2023/2024",
                        term: "Term 1",
                        classTest: 18,
                        midTerm: 27,
                        exam: 45,
                        totalScore: 90,
                        grade: "A",
                        position: 3,
                        comments: "Excellent performance. Shows great understanding of algebra concepts.",
                        dateEntered: "2023-10-10"
                    },
                    {
                        id: 2,
                        studentId: 1,
                        studentName: "John Doe",
                        class: "Form 3",
                        subject: "English Language",
                        teacherId: 2,
                        teacherName: "Mrs. Ama Serwaa",
                        academicYear: "2023/2024",
                        term: "Term 1",
                        classTest: 16,
                        midTerm: 24,
                        exam: 42,
                        totalScore: 82,
                        grade: "B",
                        position: 5,
                        comments: "Good writing skills but needs to improve vocabulary.",
                        dateEntered: "2023-10-12"
                    },
                    {
                        id: 3,
                        studentId: 2,
                        studentName: "Jane Smith",
                        class: "Form 2",
                        subject: "English Language",
                        teacherId: 2,
                        teacherName: "Mrs. Ama Serwaa",
                        academicYear: "2023/2024",
                        term: "Term 1",
                        classTest: 19,
                        midTerm: 28,
                        exam: 47,
                        totalScore: 94,
                        grade: "A",
                        position: 1,
                        comments: "Outstanding performance. Excellent command of language.",
                        dateEntered: "2023-10-12"
                    },
                    {
                        id: 4,
                        studentId: 3,
                        studentName: "Kwame Amponsah",
                        class: "Form 4",
                        subject: "Science",
                        teacherId: 3,
                        teacherName: "Mr. Kofi Asante",
                        academicYear: "2023/2024",
                        term: "Term 1",
                        classTest: 15,
                        midTerm: 22,
                        exam: 38,
                        totalScore: 75,
                        grade: "C",
                        position: 8,
                        comments: "Satisfactory performance. Needs to work on practical applications.",
                        dateEntered: "2023-10-15"
                    }
                ];
                
                // Save to localStorage
                saveDataToLocalStorage();
            }
        }

        // Save data to localStorage
        function saveDataToLocalStorage() {
            localStorage.setItem('eliteCityAcademyData', JSON.stringify(appData));
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Login page
            document.querySelectorAll('.role-option').forEach(option => {
                option.addEventListener('click', handleRoleSelection);
            });
            
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupLink').addEventListener('click', showSignupPage);
            document.getElementById('backToLoginLink').addEventListener('click', showLoginPage);
            
            // Signup page
            document.getElementById('signupRoleSelector').addEventListener('click', handleSignupRoleSelection);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            
            // Student dashboard
            document.getElementById('studentLogoutBtn').addEventListener('click', handleLogout);
            document.querySelectorAll('#studentDashboard .tab').forEach(tab => {
                tab.addEventListener('click', handleStudentTabClick);
            });
            document.getElementById('joinClassBtn').addEventListener('click', joinClass);
            document.getElementById('copyMeetCodeBtn').addEventListener('click', copyMeetCode);
            document.getElementById('studentAcademicYear').addEventListener('change', updateStudentReportCard);
            document.querySelectorAll('#studentDashboard .term-btn').forEach(btn => {
                btn.addEventListener('click', handleStudentTermSelection);
            });
            
            // Teacher dashboard
            document.getElementById('teacherLogoutBtn').addEventListener('click', handleLogout);
            document.querySelectorAll('#teacherDashboard .tab').forEach(tab => {
                tab.addEventListener('click', handleTeacherTabClick);
            });
            document.getElementById('startClassBtn').addEventListener('click', startClass);
            document.getElementById('copyTeacherMeetCodeBtn').addEventListener('click', copyTeacherMeetCode);
            document.getElementById('sendMessageToStudentsBtn').addEventListener('click', sendMessageToStudents);
            document.getElementById('createAssignmentBtn').addEventListener('click', createAssignment);
            document.getElementById('scheduleClassBtn').addEventListener('click', scheduleClass);
            document.getElementById('teacherAcademicYear').addEventListener('change', updateTeacherGradeManagement);
            document.querySelectorAll('#teacherDashboard .term-btn').forEach(btn => {
                btn.addEventListener('click', handleTeacherTermSelection);
            });
            document.getElementById('loadStudentsForGradingBtn').addEventListener('click', loadStudentsForGrading);
            document.getElementById('saveAllGradesBtn').addEventListener('click', saveAllGrades);
            
            // Admin dashboard
            document.getElementById('adminLogoutBtn').addEventListener('click', handleLogout);
            document.querySelectorAll('#adminDashboard .tab').forEach(tab => {
                tab.addEventListener('click', handleAdminTabClick);
            });
            
            // Admin user management
            document.getElementById('addStudentBtn').addEventListener('click', () => openUserModal('student', 'add'));
            document.getElementById('addTeacherBtn').addEventListener('click', () => openUserModal('teacher', 'add'));
            document.getElementById('saveUserBtn').addEventListener('click', saveUser);
            document.getElementById('deleteUserBtn').addEventListener('click', deleteUser);
            document.getElementById('closeUserModal').addEventListener('click', closeUserModal);
            
            // Admin payment system
            document.getElementById('recordPaymentBtn').addEventListener('click', togglePaymentForm);
            document.getElementById('savePaymentBtn').addEventListener('click', savePayment);
            document.getElementById('cancelPaymentBtn').addEventListener('click', togglePaymentForm);
            document.getElementById('filterStudent').addEventListener('change', filterPayments);
            document.getElementById('filterStatus').addEventListener('change', filterPayments);
            document.getElementById('filterTerm').addEventListener('change', filterPayments);
            
            // Admin gallery
            document.getElementById('addGalleryImageBtn').addEventListener('click', openGalleryModal);
            document.getElementById('saveGalleryImageBtn').addEventListener('click', saveGalleryImage);
            document.getElementById('closeGalleryModal').addEventListener('click', closeGalleryModal);
            
            // Admin events
            document.getElementById('addEventBtn').addEventListener('click', openEventModal);
            document.getElementById('saveEventBtn').addEventListener('click', saveEvent);
            document.getElementById('closeEventModal').addEventListener('click', closeEventModal);
            
            // Admin SMS system
            document.getElementById('smsRecipient').addEventListener('change', handleSMSRecipientChange);
            document.getElementById('smsMessage').addEventListener('input', updateSMSCharCount);
            document.getElementById('smsTemplate').addEventListener('change', handleSMSTemplateChange);
            document.getElementById('sendSMSBtn').addEventListener('click', sendSMS);
            
            // Admin reports
            document.getElementById('filterReportsBtn').addEventListener('click', filterAdminReports);
            document.getElementById('generateReportsBtn').addEventListener('click', generateReportCards);
            
            // Navigation links
            document.getElementById('homeLink').addEventListener('click', () => showDashboardBasedOnRole());
            document.getElementById('aboutLink').addEventListener('click', showAboutPage);
            document.getElementById('contactLink').addEventListener('click', showContactPage);
            
            // Grade modal
            document.getElementById('closeGradeModal').addEventListener('click', closeGradeModal);
            document.getElementById('saveGradeBtn').addEventListener('click', saveGrade);
            document.getElementById('modalClassTest').addEventListener('input', calculateTotalScore);
            document.getElementById('modalMidTerm').addEventListener('input', calculateTotalScore);
            document.getElementById('modalExam').addEventListener('input', calculateTotalScore);
            document.getElementById('modalTotalScore').addEventListener('input', calculateGradeFromTotal);
        }

        // Handle role selection on login page
        function handleRoleSelection(e) {
            const selectedRole = e.target.getAttribute('data-role');
            
            // Update active role
            document.querySelectorAll('.role-option').forEach(option => {
                option.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Update form placeholder based on role
            const usernameField = document.getElementById('username');
            if (selectedRole === 'admin') {
                usernameField.placeholder = "Enter admin username";
            } else {
                usernameField.placeholder = "Enter your email";
            }
        }

        // Handle signup role selection
        function handleSignupRoleSelection(e) {
            if (!e.target.classList.contains('role-option')) return;
            
            const selectedRole = e.target.getAttribute('data-role');
            
            // Update active role
            document.querySelectorAll('#signupRoleSelector .role-option').forEach(option => {
                option.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Show appropriate form
            if (selectedRole === 'student') {
                document.getElementById('studentSignupForm').style.display = 'block';
                document.getElementById('teacherSignupForm').style.display = 'none';
            } else {
                document.getElementById('studentSignupForm').style.display = 'none';
                document.getElementById('teacherSignupForm').style.display = 'block';
            }
        }

        // Handle login form submission
        function handleLogin(e) {
            e.preventDefault();
            
            const role = document.querySelector('.role-option.active').getAttribute('data-role');
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Admin login (hardcoded credentials as requested)
            if (role === 'admin') {
                if (username === 'admin' && password === 'admin123') {
                    appData.currentUser = { name: 'Administrator', role: 'admin' };
                    appData.currentRole = 'admin';
                    showAdminDashboard();
                    updateUserInfo();
                    return;
                } else {
                    alert('Invalid admin credentials. Use username: admin, password: admin123');
                    return;
                }
            }
            
            // Teacher login
            if (role === 'teacher') {
                const teacher = appData.teachers.find(t => 
                    (t.email === username || t.name.toLowerCase().includes(username.toLowerCase())) && 
                    t.password === password
                );
                
                if (teacher) {
                    appData.currentUser = teacher;
                    appData.currentRole = 'teacher';
                    showTeacherDashboard();
                    updateUserInfo();
                    return;
                }
            }
            
            // Student login
            if (role === 'student') {
                const student = appData.students.find(s => 
                    (s.email === username || s.fullName.toLowerCase().includes(username.toLowerCase())) && 
                    s.password === password
                );
                
                if (student) {
                    appData.currentUser = student;
                    appData.currentRole = 'student';
                    showStudentDashboard();
                    updateUserInfo();
                    return;
                }
            }
            
            alert('Invalid credentials. Please try again.');
        }

        // Handle signup form submission
        function handleSignup(e) {
            e.preventDefault();
            
            const role = document.querySelector('#signupRoleSelector .role-option.active').getAttribute('data-role');
            
            if (role === 'student') {
                // Create new student
                const newStudent = {
                    id: appData.students.length > 0 ? Math.max(...appData.students.map(s => s.id)) + 1 : 1,
                    firstname: document.getElementById('studentFirstname').value,
                    surname: document.getElementById('studentSurname').value,
                    fullName: document.getElementById('studentFirstname').value + ' ' + document.getElementById('studentSurname').value,
                    dob: document.getElementById('studentDob').value,
                    class: document.getElementById('studentClass').value,
                    contact: document.getElementById('studentContact').value,
                    residence: document.getElementById('studentResidence').value,
                    email: document.getElementById('studentEmail').value,
                    password: document.getElementById('studentPassword').value,
                    status: 'Active',
                    balance: 0,
                    parentContact: ''
                };
                
                appData.students.push(newStudent);
                saveDataToLocalStorage();
                
                alert('Student account created successfully! You can now login.');
                showLoginPage();
                
            } else {
                // Create new teacher
                const newTeacher = {
                    id: appData.teachers.length > 0 ? Math.max(...appData.teachers.map(t => t.id)) + 1 : 1,
                    name: document.getElementById('teacherName').value,
                    subject: document.getElementById('teacherSubject').value,
                    dob: document.getElementById('teacherDob').value,
                    residence: document.getElementById('teacherResidence').value,
                    contact: document.getElementById('teacherContact').value,
                    ssnit: document.getElementById('teacherSsnit').value,
                    qualification: document.getElementById('teacherQualification').value,
                    email: document.getElementById('teacherEmail').value,
                    password: document.getElementById('teacherPassword').value,
                    status: 'Active'
                };
                
                appData.teachers.push(newTeacher);
                saveDataToLocalStorage();
                
                alert('Teacher account created successfully! You can now login.');
                showLoginPage();
            }
        }

        // Handle logout
        function handleLogout() {
            appData.currentUser = null;
            appData.currentRole = null;
            showLoginPage();
            updateUserInfo();
        }

        // Update user info in header
        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            
            if (appData.currentUser) {
                const name = appData.currentUser.name || appData.currentUser.fullName || 'User';
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                userAvatar.textContent = initials;
                userName.textContent = name;
                
                // Update avatar color based on role
                if (appData.currentRole === 'admin') {
                    userAvatar.style.backgroundColor = 'var(--admin-red)';
                } else if (appData.currentRole === 'teacher') {
                    userAvatar.style.backgroundColor = 'var(--teacher-blue)';
                } else {
                    userAvatar.style.backgroundColor = 'var(--student-green)';
                }
            } else {
                userAvatar.textContent = 'U';
                userName.textContent = 'Guest';
                userAvatar.style.backgroundColor = 'var(--accent-gold)';
            }
        }

        // Show login page
        function showLoginPage() {
            hideAllPages();
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('navLinks').style.display = 'flex';
        }

        // Show signup page
        function showSignupPage(e) {
            if (e) e.preventDefault();
            hideAllPages();
            document.getElementById('signupPage').style.display = 'flex';
            document.getElementById('navLinks').style.display = 'flex';
        }

        // Show student dashboard
        function showStudentDashboard() {
            hideAllPages();
            document.getElementById('studentDashboard').style.display = 'block';
            document.getElementById('navLinks').style.display = 'flex';
            
            // Update student dashboard data
            updateStudentDashboard();
        }

        // Show teacher dashboard
        function showTeacherDashboard() {
            hideAllPages();
            document.getElementById('teacherDashboard').style.display = 'block';
            document.getElementById('navLinks').style.display = 'flex';
            
            // Update teacher dashboard data
            updateTeacherDashboard();
        }

        // Show admin dashboard
        function showAdminDashboard() {
            hideAllPages();
            document.getElementById('adminDashboard').style.display = 'block';
            document.getElementById('navLinks').style.display = 'flex';
            
            // Update admin dashboard data
            updateAdminDashboard();
        }

        // Show dashboard based on current role
        function showDashboardBasedOnRole() {
            if (appData.currentRole === 'admin') {
                showAdminDashboard();
            } else if (appData.currentRole === 'teacher') {
                showTeacherDashboard();
            } else if (appData.currentRole === 'student') {
                showStudentDashboard();
            } else {
                showLoginPage();
            }
        }

        // Show about page
        function showAboutPage(e) {
            if (e) e.preventDefault();
            alert('About Elite City Academy:\n\nElite City Academy is a premier educational institution committed to academic excellence and holistic development of students. Founded in 2005, we have been at the forefront of quality education in Ghana.');
        }

        // Show contact page
        function showContactPage(e) {
            if (e) e.preventDefault();
            alert('Contact Elite City Academy:\n\nAddress: 123 Academic Street, Elite City, Accra\nPhone: +233 30 123 4567\nEmail: info@elitecityacademy.edu.gh\nHours: Mon-Fri 8:00 AM - 5:00 PM');
        }

        // Hide all pages
        function hideAllPages() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('signupPage').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'none';
            document.getElementById('teacherDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
        }

        // Update student dashboard with data
        function updateStudentDashboard() {
            if (!appData.currentUser) return;
            
            // Update welcome message
            document.getElementById('studentWelcomeName').textContent = appData.currentUser.firstname || appData.currentUser.fullName;
            
            // Update class info
            document.getElementById('studentClassInfo').textContent = appData.currentUser.class;
            
            // Update balance with Ghana Cedis
            document.getElementById('studentBalance').textContent = `GHâ‚µ${appData.currentUser.balance || 0}`;
            
            // Update average grade
            const studentRecords = appData.academicRecords.filter(r => 
                r.studentId === appData.currentUser.id && r.academicYear === "2023/2024"
            );
            
            if (studentRecords.length > 0) {
                const averageScore = studentRecords.reduce((sum, record) => sum + record.totalScore, 0) / studentRecords.length;
                const averageGrade = calculateGradeFromScore(averageScore);
                document.getElementById('studentAverageGrade').textContent = averageGrade;
            }
            
            // Update pending assignments count
            const pendingAssignments = appData.assignments.filter(a => 
                a.studentId === appData.currentUser.id && a.status === 'Pending'
            ).length;
            document.getElementById('studentAssignmentCount').textContent = pendingAssignments;
            document.getElementById('dueAssignments').textContent = pendingAssignments;
            
            // Update payment status
            const pendingPayments = appData.payments.filter(p => 
                p.studentId === appData.currentUser.id && p.status === 'Pending'
            ).length;
            document.getElementById('studentPaymentStatus').textContent = pendingPayments;
            document.getElementById('pendingPayments').textContent = pendingPayments;
            
            // Update schedule table
            updateStudentScheduleTable();
            
            // Update payments table
            updateStudentPaymentsTable();
            
            // Update assignments table
            updateStudentAssignmentsTable();
            
            // Update report card
            updateStudentReportCard();
        }

        // Calculate grade from score
        function calculateGradeFromScore(score) {
            if (score >= 80) return 'A';
            else if (score >= 70) return 'B';
            else if (score >= 60) return 'C';
            else if (score >= 50) return 'D';
            else return 'F';
        }

        // Calculate grade points
        function calculateGradePoints(grade) {
            switch(grade) {
                case 'A': return 5.0;
                case 'B': return 4.0;
                case 'C': return 3.0;
                case 'D': return 2.0;
                case 'F': return 0.0;
                default: return 0.0;
            }
        }

        // Update student schedule table
        function updateStudentScheduleTable() {
            const tableBody = document.getElementById('studentScheduleTable');
            tableBody.innerHTML = '';
            
            appData.classes.forEach(cls => {
                if (cls.class === appData.currentUser.class) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${cls.time}</td>
                        <td>${cls.subject}</td>
                        <td>${cls.teacher}</td>
                        <td><button class="btn btn-sm btn-primary join-class-btn" data-code="${cls.meetCode}">Join</button></td>
                    `;
                    tableBody.appendChild(row);
                }
            });
            
            // Add event listeners to join buttons
            document.querySelectorAll('.join-class-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const meetCode = this.getAttribute('data-code');
                    document.getElementById('meetCode').textContent = meetCode;
                    joinClass();
                });
            });
        }

        // Update student payments table
        function updateStudentPaymentsTable() {
            const tableBody = document.getElementById('studentPaymentsTable');
            tableBody.innerHTML = '';
            
            const studentPayments = appData.payments.filter(p => p.studentId === appData.currentUser.id);
            
            studentPayments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.date}</td>
                    <td>${payment.description}</td>
                    <td>GHâ‚µ${payment.amount}</td>
                    <td><span class="badge ${payment.status === 'Paid' ? 'badge-success' : payment.status === 'Partial' ? 'badge-warning' : 'badge-danger'}">${payment.status}</span></td>
                    <td>${payment.receiptNo}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Update student assignments table
        function updateStudentAssignmentsTable() {
            const tableBody = document.getElementById('studentAssignmentsTable');
            tableBody.innerHTML = '';
            
            const studentAssignments = appData.assignments.filter(a => a.studentId === appData.currentUser.id);
            
            studentAssignments.forEach(assignment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${assignment.subject}</td>
                    <td>${assignment.title}</td>
                    <td>${assignment.dueDate}</td>
                    <td><span class="badge badge-warning">${assignment.status}</span></td>
                    <td><button class="btn btn-sm btn-success submit-assignment-btn">Submit</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Update student report card
        function updateStudentReportCard() {
            const container = document.getElementById('studentReportCardContainer');
            const academicYear = document.getElementById('studentAcademicYear').value;
            const activeTerm = document.querySelector('#studentDashboard .term-btn.active').getAttribute('data-term');
            
            const studentRecords = appData.academicRecords.filter(r => 
                r.studentId === appData.currentUser.id && 
                r.academicYear === academicYear &&
                (activeTerm === 'Annual' || r.term === activeTerm)
            );
            
            if (studentRecords.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>No report card available yet.</strong>
                            <p>Your grades for ${academicYear} ${activeTerm} have not been entered yet.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Calculate statistics
            const totalSubjects = studentRecords.length;
            const averageScore = studentRecords.reduce((sum, record) => sum + record.totalScore, 0) / totalSubjects;
            const averageGrade = calculateGradeFromScore(averageScore);
            const totalGradePoints = studentRecords.reduce((sum, record) => sum + calculateGradePoints(record.grade), 0);
            const gpa = totalGradePoints / totalSubjects;
            
            // Find best and worst subjects
            const bestSubject = studentRecords.reduce((best, record) => 
                record.totalScore > best.totalScore ? record : best
            );
            
            const worstSubject = studentRecords.reduce((worst, record) => 
                record.totalScore < worst.totalScore ? record : worst
            );
            
            // Count grades
            const gradeCounts = { A: 0, B: 0, C: 0, D: 0, F: 0 };
            studentRecords.forEach(record => {
                if (gradeCounts[record.grade] !== undefined) {
                    gradeCounts[record.grade]++;
                }
            });
            
            // Generate report card HTML
            container.innerHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <h3>ACADEMIC REPORT CARD</h3>
                        <p>Elite City Academy - ${academicYear} ${activeTerm !== 'Annual' ? activeTerm : ''}</p>
                    </div>
                    
                    <div class="student-info">
                        <div class="info-item">
                            <span class="info-label">Student Name</span>
                            <span class="info-value">${appData.currentUser.fullName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Class</span>
                            <span class="info-value">${appData.currentUser.class}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Academic Year</span>
                            <span class="info-value">${academicYear}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Term</span>
                            <span class="info-value">${activeTerm}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Date Generated</span>
                            <span class="info-value">${new Date().toLocaleDateString()}</span>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 1rem;">Academic Performance</h4>
                    <table class="grade-table">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Class Test (20)</th>
                                <th>Mid-Term (30)</th>
                                <th>Exam (50)</th>
                                <th>Total (100)</th>
                                <th>Grade</th>
                                <th>Position</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${studentRecords.map(record => `
                                <tr>
                                    <td>${record.subject}</td>
                                    <td>${record.classTest}</td>
                                    <td>${record.midTerm}</td>
                                    <td>${record.exam}</td>
                                    <td class="grade-score ${'grade-' + record.grade}">${record.totalScore}</td>
                                    <td><span class="badge ${'grade-' + record.grade}">${record.grade}</span></td>
                                    <td>${record.position}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="grade-summary">
                        <div class="summary-card">
                            <div class="summary-value">${averageScore.toFixed(1)}%</div>
                            <div class="summary-label">Average Score</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value">${averageGrade}</div>
                            <div class="summary-label">Average Grade</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value">${gpa.toFixed(2)}</div>
                            <div class="summary-label">GPA</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-value">${totalSubjects}</div>
                            <div class="summary-label">Subjects Taken</div>
                        </div>
                    </div>
                    
                    <div class="teacher-comments">
                        <h4>Teacher Comments</h4>
                        ${studentRecords.map(record => `
                            <div class="comment-box">
                                <div class="comment-subject">${record.subject}</div>
                                <div class="comment-text">${record.comments}</div>
                                <div class="comment-teacher">- ${record.teacherName}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 2rem; text-align: center;">
                        <button class="print-btn" onclick="window.print()">
                            <i class="fas fa-print"></i> Print Report Card
                        </button>
                    </div>
                </div>
            `;
        }

        // Handle student term selection
        function handleStudentTermSelection(e) {
            // Update active term button
            document.querySelectorAll('#studentDashboard .term-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Update report card
            updateStudentReportCard();
        }

        // Update teacher dashboard with data
        function updateTeacherDashboard() {
            if (!appData.currentUser) return;
            
            // Get teacher's subjects and classes
            const teacherSubjects = appData.currentUser.subject ? appData.currentUser.subject.split(',').map(s => s.trim()) : [];
            
            // Extract class names from subjects
            const classNames = teacherSubjects.map(subject => {
                const match = subject.match(/Form \d+/);
                return match ? match[0] : null;
            }).filter(cls => cls !== null);
            
            // Count students in those classes
            const studentCount = appData.students.filter(student => 
                classNames.includes(student.class)
            ).length;
            
            // Count pending grades
            const pendingGrades = appData.academicRecords.filter(record => 
                record.teacherId === appData.currentUser.id && 
                (record.classTest === 0 || record.midTerm === 0 || record.exam === 0)
            ).length;
            
            document.getElementById('teacherStudentCount').textContent = studentCount;
            document.getElementById('teacherSubjectCount').textContent = teacherSubjects.length;
            document.getElementById('teacherGradesPending').textContent = pendingGrades;
            
            // Update assignments count
            const assignmentCount = appData.assignments.filter(a => 
                a.assignedBy === appData.currentUser.name
            ).length;
            document.getElementById('teacherAssignmentCount').textContent = assignmentCount;
            
            // Update classes table
            updateTeacherClassesTable();
            
            // Update students table
            updateTeacherStudentsTable();
            
            // Update assignments table
            updateTeacherAssignmentsTable();
            
            // Update grade management
            updateTeacherGradeManagement();
        }

        // Update teacher grade management
        function updateTeacherGradeManagement() {
            // Populate class dropdown
            const classSelect = document.getElementById('gradeClassSelect');
            classSelect.innerHTML = '<option value="">Select Class</option>';
            
            // Get teacher's classes
            const teacherSubjects = appData.currentUser.subject ? appData.currentUser.subject.split(',').map(s => s.trim()) : [];
            const uniqueClasses = [...new Set(teacherSubjects.map(subject => {
                const match = subject.match(/Form \d+/);
                return match ? match[0] : null;
            }).filter(cls => cls !== null))];
            
            uniqueClasses.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls;
                option.textContent = cls;
                classSelect.appendChild(option);
            });
            
            // Populate subject dropdown
            const subjectSelect = document.getElementById('gradeSubjectSelect');
            subjectSelect.innerHTML = '<option value="">Select Subject</option>';
            
            // Extract subjects (remove class names)
            const subjects = teacherSubjects.map(subject => {
                return subject.replace(/Form \d+/g, '').trim();
            }).filter(subject => subject !== '');
            
            const uniqueSubjects = [...new Set(subjects)];
            uniqueSubjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectSelect.appendChild(option);
            });
            
            // Update grades history table
            updateTeacherGradesHistoryTable();
        }

        // Update teacher grades history table
        function updateTeacherGradesHistoryTable() {
            const tableBody = document.getElementById('teacherGradesHistoryTable');
            tableBody.innerHTML = '';
            
            const academicYear = document.getElementById('teacherAcademicYear').value;
            const activeTerm = document.querySelector('#teacherDashboard .term-btn.active').getAttribute('data-term');
            
            // Get teacher's grades
            const teacherGrades = appData.academicRecords.filter(record => 
                record.teacherId === appData.currentUser.id &&
                record.academicYear === academicYear &&
                (activeTerm === 'All' || record.term === activeTerm)
            );
            
            // Group by subject and class
            const groupedGrades = {};
            teacherGrades.forEach(record => {
                const key = `${record.subject}-${record.class}-${record.term}`;
                if (!groupedGrades[key]) {
                    groupedGrades[key] = {
                        subject: record.subject,
                        class: record.class,
                        term: record.term,
                        students: 0,
                        lastUpdated: record.dateEntered || 'N/A'
                    };
                }
                groupedGrades[key].students++;
            });
            
            // Populate table
            Object.values(groupedGrades).forEach(group => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${group.subject}</td>
                    <td>${group.class}</td>
                    <td>${group.term}</td>
                    <td>${group.students} students</td>
                    <td>${group.lastUpdated}</td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-grades-btn" data-subject="${group.subject}" data-class="${group.class}" data-term="${group.term}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-grades-btn" data-subject="${group.subject}" data-class="${group.class}" data-term="${group.term}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Handle teacher term selection
        function handleTeacherTermSelection(e) {
            // Update active term button
            document.querySelectorAll('#teacherDashboard .term-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Update grade management
            updateTeacherGradeManagement();
        }

        // Load students for grading
        function loadStudentsForGrading() {
            const selectedClass = document.getElementById('gradeClassSelect').value;
            const selectedSubject = document.getElementById('gradeSubjectSelect').value;
            
            if (!selectedClass || !selectedSubject) {
                alert('Please select both class and subject.');
                return;
            }
            
            // Get academic year and term
            const academicYear = document.getElementById('teacherAcademicYear').value;
            const activeTerm = document.querySelector('#teacherDashboard .term-btn.active').getAttribute('data-term');
            
            // Update headers
            document.getElementById('gradingSubject').textContent = selectedSubject;
            document.getElementById('gradingClass').textContent = selectedClass;
            
            // Get students in the selected class
            const students = appData.students.filter(student => student.class === selectedClass);
            
            // Generate grade entry table
            const tableBody = document.getElementById('gradeEntryTable');
            tableBody.innerHTML = '';
            
            students.forEach(student => {
                // Check if grade already exists
                const existingGrade = appData.academicRecords.find(record => 
                    record.studentId === student.id &&
                    record.subject === selectedSubject &&
                    record.academicYear === academicYear &&
                    record.term === activeTerm
                );
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>STU${student.id.toString().padStart(3, '0')}</td>
                    <td>${student.fullName}</td>
                    <td><input type="number" class="form-control grade-input class-test-input" min="0" max="20" step="0.5" value="${existingGrade ? existingGrade.classTest : ''}" data-student-id="${student.id}"></td>
                    <td><input type="number" class="form-control grade-input mid-term-input" min="0" max="30" step="0.5" value="${existingGrade ? existingGrade.midTerm : ''}" data-student-id="${student.id}"></td>
                    <td><input type="number" class="form-control grade-input exam-input" min="0" max="50" step="0.5" value="${existingGrade ? existingGrade.exam : ''}" data-student-id="${student.id}"></td>
                    <td><input type="number" class="form-control total-score-input" readonly data-student-id="${student.id}"></td>
                    <td><select class="form-control grade-select grade-input" data-student-id="${student.id}">
                        <option value="">Select Grade</option>
                        <option value="A" ${existingGrade && existingGrade.grade === 'A' ? 'selected' : ''}>A</option>
                        <option value="B" ${existingGrade && existingGrade.grade === 'B' ? 'selected' : ''}>B</option>
                        <option value="C" ${existingGrade && existingGrade.grade === 'C' ? 'selected' : ''}>C</option>
                        <option value="D" ${existingGrade && existingGrade.grade === 'D' ? 'selected' : ''}>D</option>
                        <option value="F" ${existingGrade && existingGrade.grade === 'F' ? 'selected' : ''}>F</option>
                    </select></td>
                    <td><input type="text" class="form-control comments-input" placeholder="Comments" value="${existingGrade ? existingGrade.comments : ''}" data-student-id="${student.id}"></td>
                    <td><button class="btn btn-sm btn-success calculate-grade-btn" data-student-id="${student.id}">Calculate</button></td>
                `;
                tableBody.appendChild(row);
                
                // Calculate initial total if grade exists
                if (existingGrade) {
                    const classTestInput = row.querySelector('.class-test-input');
                    const midTermInput = row.querySelector('.mid-term-input');
                    const examInput = row.querySelector('.exam-input');
                    const totalScoreInput = row.querySelector('.total-score-input');
                    
                    if (classTestInput.value && midTermInput.value && examInput.value) {
                        const total = parseFloat(classTestInput.value) + parseFloat(midTermInput.value) + parseFloat(examInput.value);
                        totalScoreInput.value = total.toFixed(1);
                    }
                }
            });
            
            // Add event listeners to calculate buttons
            document.querySelectorAll('.calculate-grade-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-student-id'));
                    calculateGradeForStudent(studentId);
                });
            });
            
            // Add event listeners to grade inputs
            document.querySelectorAll('.grade-input').forEach(input => {
                input.addEventListener('input', function() {
                    const studentId = parseInt(this.getAttribute('data-student-id'));
                    calculateGradeForStudent(studentId);
                });
            });
            
            // Show the table
            document.getElementById('gradeEntryTableContainer').style.display = 'block';
        }

        // Calculate grade for a student
        function calculateGradeForStudent(studentId) {
            const row = document.querySelector(`tr [data-student-id="${studentId}"]`).closest('tr');
            const classTest = parseFloat(row.querySelector('.class-test-input').value) || 0;
            const midTerm = parseFloat(row.querySelector('.mid-term-input').value) || 0;
            const exam = parseFloat(row.querySelector('.exam-input').value) || 0;
            const totalScore = classTest + midTerm + exam;
            const gradeSelect = row.querySelector('.grade-select');
            const totalScoreInput = row.querySelector('.total-score-input');
            
            // Update total score
            totalScoreInput.value = totalScore.toFixed(1);
            
            // Calculate and set grade if not manually selected
            if (!gradeSelect.value) {
                const calculatedGrade = calculateGradeFromScore(totalScore);
                gradeSelect.value = calculatedGrade;
            }
        }

        // Save all grades
        function saveAllGrades() {
            const selectedClass = document.getElementById('gradeClassSelect').value;
            const selectedSubject = document.getElementById('gradeSubjectSelect').value;
            const academicYear = document.getElementById('teacherAcademicYear').value;
            const activeTerm = document.querySelector('#teacherDashboard .term-btn.active').getAttribute('data-term');
            
            let gradesSaved = 0;
            let errors = [];
            
            // Process each row
            document.querySelectorAll('#gradeEntryTable tr').forEach(row => {
                const studentId = parseInt(row.querySelector('[data-student-id]').getAttribute('data-student-id'));
                const classTest = row.querySelector('.class-test-input').value;
                const midTerm = row.querySelector('.mid-term-input').value;
                const exam = row.querySelector('.exam-input').value;
                const grade = row.querySelector('.grade-select').value;
                const comments = row.querySelector('.comments-input').value;
                
                // Validate
                if (!classTest || !midTerm || !exam || !grade) {
                    errors.push(`Student ID: STU${studentId.toString().padStart(3, '0')} - Incomplete data`);
                    return;
                }
                
                // Calculate total
                const totalScore = parseFloat(classTest) + parseFloat(midTerm) + parseFloat(exam);
                
                // Find student
                const student = appData.students.find(s => s.id === studentId);
                if (!student) return;
                
                // Check if grade already exists
                const existingIndex = appData.academicRecords.findIndex(record => 
                    record.studentId === studentId &&
                    record.subject === selectedSubject &&
                    record.academicYear === academicYear &&
                    record.term === activeTerm
                );
                
                if (existingIndex !== -1) {
                    // Update existing grade
                    appData.academicRecords[existingIndex] = {
                        ...appData.academicRecords[existingIndex],
                        classTest: parseFloat(classTest),
                        midTerm: parseFloat(midTerm),
                        exam: parseFloat(exam),
                        totalScore: totalScore,
                        grade: grade,
                        comments: comments,
                        dateEntered: new Date().toISOString().split('T')[0]
                    };
                } else {
                    // Create new grade record
                    const newRecord = {
                        id: appData.academicRecords.length > 0 ? Math.max(...appData.academicRecords.map(r => r.id)) + 1 : 1,
                        studentId: studentId,
                        studentName: student.fullName,
                        class: selectedClass,
                        subject: selectedSubject,
                        teacherId: appData.currentUser.id,
                        teacherName: appData.currentUser.name,
                        academicYear: academicYear,
                        term: activeTerm,
                        classTest: parseFloat(classTest),
                        midTerm: parseFloat(midTerm),
                        exam: parseFloat(exam),
                        totalScore: totalScore,
                        grade: grade,
                        position: 0, // Will be calculated later
                        comments: comments,
                        dateEntered: new Date().toISOString().split('T')[0]
                    };
                    
                    appData.academicRecords.push(newRecord);
                }
                
                gradesSaved++;
            });
            
            // Calculate positions for the class
            calculateClassPositions(selectedClass, selectedSubject, academicYear, activeTerm);
            
            // Save data
            saveDataToLocalStorage();
            
            // Update dashboard
            updateTeacherDashboard();
            
            // Show result
            if (errors.length === 0) {
                alert(`Successfully saved ${gradesSaved} grades for ${selectedSubject} - ${selectedClass}`);
            } else {
                alert(`Saved ${gradesSaved} grades. Errors:\n${errors.join('\n')}`);
            }
        }

        // Calculate class positions
        function calculateClassPositions(className, subject, academicYear, term) {
            // Get all grades for this class, subject, year, and term
            const classGrades = appData.academicRecords.filter(record => 
                record.class === className &&
                record.subject === subject &&
                record.academicYear === academicYear &&
                record.term === term
            );
            
            // Sort by total score (descending)
            classGrades.sort((a, b) => b.totalScore - a.totalScore);
            
            // Assign positions
            classGrades.forEach((record, index) => {
                record.position = index + 1;
                
                // Update in main array
                const recordIndex = appData.academicRecords.findIndex(r => 
                    r.id === record.id
                );
                
                if (recordIndex !== -1) {
                    appData.academicRecords[recordIndex].position = index + 1;
                }
            });
        }

        // Update teacher classes table
        function updateTeacherClassesTable() {
            const tableBody = document.getElementById('teacherClassesTable');
            tableBody.innerHTML = '';
            
            // Filter classes taught by this teacher
            const teacherClasses = appData.classes.filter(cls => 
                cls.teacher === appData.currentUser.name
            );
            
            teacherClasses.forEach(cls => {
                const studentCount = appData.students.filter(s => s.class === cls.class).length;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${cls.day}, ${cls.time}</td>
                    <td>${cls.class}</td>
                    <td>${cls.subject}</td>
                    <td>${studentCount} students</td>
                    <td><button class="btn btn-sm btn-primary start-class-btn" data-code="${cls.meetCode}">Start</button></td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to start buttons
            document.querySelectorAll('.start-class-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const meetCode = this.getAttribute('data-code');
                    document.getElementById('teacherMeetCode').textContent = meetCode;
                    startClass();
                });
            });
        }

        // Update teacher students table
        function updateTeacherStudentsTable() {
            const tableBody = document.getElementById('teacherStudentsTable');
            tableBody.innerHTML = '';
            
            // Get teacher's subjects and extract classes
            const teacherSubjects = appData.currentUser.subject ? appData.currentUser.subject.split(',') : [];
            const teacherClasses = teacherSubjects.map(subject => {
                const match = subject.match(/Form \d+/);
                return match ? match[0] : null;
            }).filter(cls => cls !== null);
            
            // Filter students in those classes
            const students = appData.students.filter(student => 
                teacherClasses.includes(student.class)
            );
            
            students.forEach(student => {
                // Get average grade for this student
                const studentRecords = appData.academicRecords.filter(r => 
                    r.studentId === student.id
                );
                
                let performance = 'No grades';
                if (studentRecords.length > 0) {
                    const averageScore = studentRecords.reduce((sum, record) => sum + record.totalScore, 0) / studentRecords.length;
                    performance = calculateGradeFromScore(averageScore);
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>STU${student.id.toString().padStart(3, '0')}</td>
                    <td>${student.fullName}</td>
                    <td>${student.class}</td>
                    <td>${student.contact}</td>
                    <td><span class="badge badge-success">${performance}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary view-student-btn" data-id="${student.id}">View</button>
                        <button class="btn btn-sm btn-success enter-grade-btn" data-id="${student.id}">Enter Grade</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to enter grade buttons
            document.querySelectorAll('.enter-grade-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    openGradeModal(studentId);
                });
            });
        }

        // Open grade modal
        function openGradeModal(studentId) {
            const student = appData.students.find(s => s.id === studentId);
            if (!student) return;
            
            document.getElementById('modalStudentName').textContent = student.fullName;
            document.getElementById('modalGradeStudentId').value = studentId;
            
            // Show modal
            document.getElementById('gradeModal').style.display = 'flex';
        }

        // Close grade modal
        function closeGradeModal() {
            document.getElementById('gradeModal').style.display = 'none';
            document.getElementById('gradeModalForm').reset();
        }

        // Calculate total score in modal
        function calculateTotalScore() {
            const classTest = parseFloat(document.getElementById('modalClassTest').value) || 0;
            const midTerm = parseFloat(document.getElementById('modalMidTerm').value) || 0;
            const exam = parseFloat(document.getElementById('modalExam').value) || 0;
            const totalScore = classTest + midTerm + exam;
            
            document.getElementById('modalTotalScore').value = totalScore.toFixed(1);
            
            // Calculate grade from total score
            calculateGradeFromTotal();
        }

        // Calculate grade from total score
        function calculateGradeFromTotal() {
            const totalScore = parseFloat(document.getElementById('modalTotalScore').value) || 0;
            const gradeSelect = document.getElementById('modalGrade');
            
            if (totalScore >= 80) gradeSelect.value = 'A';
            else if (totalScore >= 70) gradeSelect.value = 'B';
            else if (totalScore >= 60) gradeSelect.value = 'C';
            else if (totalScore >= 50) gradeSelect.value = 'D';
            else gradeSelect.value = 'F';
        }

        // Save grade from modal
        function saveGrade() {
            const studentId = parseInt(document.getElementById('modalGradeStudentId').value);
            const classTest = parseFloat(document.getElementById('modalClassTest').value);
            const midTerm = parseFloat(document.getElementById('modalMidTerm').value);
            const exam = parseFloat(document.getElementById('modalExam').value);
            const totalScore = parseFloat(document.getElementById('modalTotalScore').value);
            const grade = document.getElementById('modalGrade').value;
            const position = parseInt(document.getElementById('modalPosition').value);
            const comments = document.getElementById('modalComments').value;
            
            // Validation
            if (!classTest || !midTerm || !exam || !grade || !position) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const student = appData.students.find(s => s.id === studentId);
            if (!student) {
                alert('Student not found.');
                return;
            }
            
            // For now, we'll use default values for subject, term, etc.
            // In a real implementation, these would be selected by the teacher
            const newRecord = {
                id: appData.academicRecords.length > 0 ? Math.max(...appData.academicRecords.map(r => r.id)) + 1 : 1,
                studentId: studentId,
                studentName: student.fullName,
                class: student.class,
                subject: "Mathematics", // Default, should be selected
                teacherId: appData.currentUser.id,
                teacherName: appData.currentUser.name,
                academicYear: "2023/2024",
                term: "Term 1",
                classTest: classTest,
                midTerm: midTerm,
                exam: exam,
                totalScore: totalScore,
                grade: grade,
                position: position,
                comments: comments,
                dateEntered: new Date().toISOString().split('T')[0]
            };
            
            appData.academicRecords.push(newRecord);
            saveDataToLocalStorage();
            
            // Update dashboard
            updateTeacherDashboard();
            
            alert('Grade saved successfully!');
            closeGradeModal();
        }

        // Update teacher assignments table
        function updateTeacherAssignmentsTable() {
            const tableBody = document.getElementById('teacherAssignmentsTable');
            tableBody.innerHTML = '';
            
            const teacherAssignments = appData.assignments.filter(a => 
                a.assignedBy === appData.currentUser.name
            );
            
            teacherAssignments.forEach(assignment => {
                const submittedCount = Math.floor(Math.random() * 10); // Random for demo
                const totalStudents = appData.students.filter(s => s.class === assignment.class).length;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${assignment.title}</td>
                    <td>${assignment.class}</td>
                    <td>${assignment.dueDate}</td>
                    <td>${submittedCount}/${totalStudents}</td>
                    <td><span class="badge badge-warning">${assignment.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary">Edit</button>
                        <button class="btn btn-sm btn-danger">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Update admin dashboard with data
        function updateAdminDashboard() {
            // Update counts
            document.getElementById('adminTotalStudents').textContent = appData.students.length;
            document.getElementById('adminTotalTeachers').textContent = appData.teachers.length;
            
            const totalRevenue = appData.payments
                .filter(p => p.status === 'Paid')
                .reduce((sum, payment) => sum + payment.amount, 0);
            document.getElementById('adminTotalRevenue').textContent = `GHâ‚µ${totalRevenue}`;
            
            // Count report cards
            const uniqueReportCards = new Set(appData.academicRecords.map(r => `${r.studentId}-${r.academicYear}-${r.term}`)).size;
            document.getElementById('adminReportCards').textContent = uniqueReportCards;
            
            // Update students table
            updateAdminStudentsTable();
            
            // Update teachers table
            updateAdminTeachersTable();
            
            // Update payments table
            updateAdminPaymentsTable();
            
            // Update gallery
            updateAdminGallery();
            
            // Update events table
            updateAdminEventsTable();
            
            // Update SMS recipient dropdown
            updateSMSRecipientDropdown();
            
            // Update SMS history table
            updateSMSHistoryTable();
            
            // Update payment student dropdowns
            updatePaymentStudentDropdowns();
            
            // Update academic reports
            updateAdminReports();
        }

        // Update admin reports
        function updateAdminReports() {
            const tableBody = document.getElementById('adminReportsTable');
            tableBody.innerHTML = '';
            
            // Get unique student-term combinations
            const studentTerms = {};
            
            appData.academicRecords.forEach(record => {
                const key = `${record.studentId}-${record.academicYear}-${record.term}`;
                if (!studentTerms[key]) {
                    studentTerms[key] = {
                        studentId: record.studentId,
                        studentName: record.studentName,
                        class: record.class,
                        academicYear: record.academicYear,
                        term: record.term,
                        records: []
                    };
                }
                studentTerms[key].records.push(record);
            });
            
            // Calculate averages and populate table
            Object.values(studentTerms).forEach(item => {
                const totalScore = item.records.reduce((sum, record) => sum + record.totalScore, 0);
                const averageScore = totalScore / item.records.length;
                const averageGrade = calculateGradeFromScore(averageScore);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.studentName}</td>
                    <td>${item.class}</td>
                    <td>${item.term} (${item.academicYear})</td>
                    <td><span class="badge grade-${averageGrade}">${averageGrade} (${averageScore.toFixed(1)}%)</span></td>
                    <td>${item.records[0].position || 'N/A'}</td>
                    <td><span class="badge badge-success">Completed</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary view-report-btn" data-student-id="${item.studentId}" data-year="${item.academicYear}" data-term="${item.term}">View</button>
                        <button class="btn btn-sm btn-danger delete-report-btn" data-student-id="${item.studentId}" data-year="${item.academicYear}" data-term="${item.term}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Filter admin reports
        function filterAdminReports() {
            const selectedClass = document.getElementById('adminReportClass').value;
            const selectedTerm = document.getElementById('adminReportTerm').value;
            const tableBody = document.getElementById('adminReportsTable');
            
            // Show all rows initially
            tableBody.querySelectorAll('tr').forEach(row => {
                row.style.display = '';
            });
            
            // Apply filters
            if (selectedClass) {
                tableBody.querySelectorAll('tr').forEach(row => {
                    const classCell = row.querySelector('td:nth-child(2)');
                    if (classCell && !classCell.textContent.includes(selectedClass)) {
                        row.style.display = 'none';
                    }
                });
            }
            
            if (selectedTerm) {
                tableBody.querySelectorAll('tr').forEach(row => {
                    const termCell = row.querySelector('td:nth-child(3)');
                    if (termCell && !termCell.textContent.includes(selectedTerm)) {
                        row.style.display = 'none';
                    }
                });
            }
        }

        // Generate report cards
        function generateReportCards() {
            const selectedClass = document.getElementById('generateClass').value;
            const selectedTerm = document.getElementById('generateTerm').value;
            const academicYear = document.getElementById('generateAcademicYear').value;
            
            if (!selectedClass) {
                alert('Please select a class.');
                return;
            }
            
            // Count students with report cards
            const studentsInClass = appData.students.filter(s => s.class === selectedClass);
            const reportCards = appData.academicRecords.filter(r => 
                r.class === selectedClass &&
                r.term === selectedTerm &&
                r.academicYear === academicYear
            );
            
            const uniqueStudents = new Set(reportCards.map(r => r.studentId)).size;
            
            alert(`Report card generation for ${selectedClass}, ${selectedTerm} ${academicYear}:\n\n` +
                  `- Total students in class: ${studentsInClass.length}\n` +
                  `- Students with grades: ${uniqueStudents}\n` +
                  `- Missing grades: ${studentsInClass.length - uniqueStudents}\n\n` +
                  `In a real system, this would generate PDF report cards for all students.`);
        }

        // Update admin students table
        function updateAdminStudentsTable() {
            const tableBody = document.getElementById('adminStudentsTable');
            tableBody.innerHTML = '';
            
            appData.students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>STU${student.id.toString().padStart(3, '0')}</td>
                    <td>${student.fullName}</td>
                    <td>${student.class}</td>
                    <td>${student.contact}</td>
                    <td>${student.residence}</td>
                    <td class="currency">GHâ‚µ${student.balance || 0}</td>
                    <td><span class="badge badge-success">${student.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-student-btn" data-id="${student.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-student-btn" data-id="${student.id}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.edit-student-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    openUserModal('student', 'edit', studentId);
                });
            });
            
            document.querySelectorAll('.delete-student-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Are you sure you want to delete this student?')) {
                        deleteStudent(studentId);
                    }
                });
            });
        }

        // Update admin teachers table
        function updateAdminTeachersTable() {
            const tableBody = document.getElementById('adminTeachersTable');
            tableBody.innerHTML = '';
            
            appData.teachers.forEach(teacher => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>TCH${teacher.id.toString().padStart(3, '0')}</td>
                    <td>${teacher.name}</td>
                    <td>${teacher.subject}</td>
                    <td>${teacher.contact}</td>
                    <td>${teacher.qualification}</td>
                    <td>${teacher.ssnit}</td>
                    <td><span class="badge badge-success">${teacher.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-teacher-btn" data-id="${teacher.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-teacher-btn" data-id="${teacher.id}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            document.querySelectorAll('.edit-teacher-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teacherId = parseInt(this.getAttribute('data-id'));
                    openUserModal('teacher', 'edit', teacherId);
                });
            });
            
            document.querySelectorAll('.delete-teacher-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const teacherId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Are you sure you want to delete this teacher?')) {
                        deleteTeacher(teacherId);
                    }
                });
            });
        }

        // Update admin payments table
        function updateAdminPaymentsTable() {
            const tableBody = document.getElementById('adminPaymentsTable');
            tableBody.innerHTML = '';
            
            // Get filter values
            const filterStudent = document.getElementById('filterStudent').value;
            const filterStatus = document.getElementById('filterStatus').value;
            const filterTerm = document.getElementById('filterTerm').value;
            
            // Filter payments
            let filteredPayments = appData.payments;
            
            if (filterStudent) {
                filteredPayments = filteredPayments.filter(p => p.studentId === parseInt(filterStudent));
            }
            
            if (filterStatus) {
                filteredPayments = filteredPayments.filter(p => p.status === filterStatus);
            }
            
            if (filterTerm) {
                filteredPayments = filteredPayments.filter(p => p.term === filterTerm);
            }
            
            filteredPayments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.date}</td>
                    <td>${payment.studentName}</td>
                    <td>${payment.description}</td>
                    <td>${payment.term}</td>
                    <td class="currency">GHâ‚µ${payment.amount}</td>
                    <td><span class="badge ${payment.status === 'Paid' ? 'badge-success' : payment.status === 'Partial' ? 'badge-warning' : 'badge-danger'}">${payment.status}</span></td>
                    <td>${payment.receiptNo}</td>
                    <td>
                        <button class="btn btn-sm btn-success mark-paid-btn" data-id="${payment.id}">Mark Paid</button>
                        <button class="btn btn-sm btn-danger delete-payment-btn" data-id="${payment.id}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to mark paid buttons
            document.querySelectorAll('.mark-paid-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const paymentId = parseInt(this.getAttribute('data-id'));
                    markPaymentAsPaid(paymentId);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-payment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const paymentId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Are you sure you want to delete this payment record?')) {
                        deletePayment(paymentId);
                    }
                });
            });
        }

        // Update admin gallery
        function updateAdminGallery() {
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = '';
            
            appData.gallery.forEach(image => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.innerHTML = `
                    <img src="${image.imageUrl}" alt="${image.title}">
                    <div class="gallery-caption">
                        <h4>${image.title}</h4>
                        <p>${image.description}</p>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                            <span class="badge badge-primary">${image.category}</span>
                            <button class="btn btn-sm btn-danger delete-image-btn" data-id="${image.id}">Delete</button>
                        </div>
                    </div>
                `;
                galleryGrid.appendChild(galleryItem);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-image-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const imageId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Are you sure you want to delete this image?')) {
                        deleteGalleryImage(imageId);
                    }
                });
            });
        }

        // Update admin events table
        function updateAdminEventsTable() {
            const tableBody = document.getElementById('adminEventsTable');
            tableBody.innerHTML = '';
            
            appData.events.forEach(event => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${event.title}</td>
                    <td>${event.date} at ${event.time}</td>
                    <td>${event.description.substring(0, 50)}${event.description.length > 50 ? '...' : ''}</td>
                    <td>${event.audience}</td>
                    <td><span class="badge badge-success">${event.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-event-btn" data-id="${event.id}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-event-btn" data-id="${event.id}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-event-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const eventId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Are you sure you want to delete this event?')) {
                        deleteEvent(eventId);
                    }
                });
            });
        }

        // Update SMS recipient dropdown
        function updateSMSRecipientDropdown() {
            const specificRecipientSelect = document.getElementById('specificRecipient');
            specificRecipientSelect.innerHTML = '<option value="">Select User</option>';
            
            // Add students
            appData.students.forEach(student => {
                const option = document.createElement('option');
                option.value = `student_${student.id}`;
                option.textContent = `Student: ${student.fullName} (${student.class})`;
                specificRecipientSelect.appendChild(option);
            });
            
            // Add teachers
            appData.teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = `teacher_${teacher.id}`;
                option.textContent = `Teacher: ${teacher.name}`;
                specificRecipientSelect.appendChild(option);
            });
        }

        // Update SMS history table
        function updateSMSHistoryTable() {
            const tableBody = document.getElementById('smsHistoryTable');
            tableBody.innerHTML = '';
            
            appData.smsHistory.forEach(sms => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sms.date}</td>
                    <td>${sms.recipient}</td>
                    <td>${sms.message.substring(0, 40)}${sms.message.length > 40 ? '...' : ''}</td>
                    <td><span class="badge badge-success">${sms.status}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Update payment student dropdowns
        function updatePaymentStudentDropdowns() {
            const paymentSelect = document.getElementById('paymentStudentSelect');
            const filterSelect = document.getElementById('filterStudent');
            
            paymentSelect.innerHTML = '<option value="">Select Student</option>';
            filterSelect.innerHTML = '<option value="">All Students</option>';
            
            appData.students.forEach(student => {
                const option1 = document.createElement('option');
                option1.value = student.id;
                option1.textContent = `${student.fullName} (${student.class})`;
                paymentSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = student.id;
                option2.textContent = `${student.fullName} (${student.class})`;
                filterSelect.appendChild(option2);
            });
        }

        // Handle student tab click
        function handleStudentTabClick(e) {
            const tabId = e.target.getAttribute('data-tab');
            
            // Update active tab
            document.querySelectorAll('#studentDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Show corresponding tab content
            document.querySelectorAll('#studentDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}Tab`).classList.add('active');
        }

        // Handle teacher tab click
        function handleTeacherTabClick(e) {
            const tabId = e.target.getAttribute('data-tab');
            
            // Update active tab
            document.querySelectorAll('#teacherDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Show corresponding tab content
            document.querySelectorAll('#teacherDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`teacher${tabId.charAt(0).toUpperCase() + tabId.slice(1)}Tab`).classList.add('active');
        }

        // Handle admin tab click
        function handleAdminTabClick(e) {
            const tabId = e.target.getAttribute('data-tab');
            
            // Update active tab
            document.querySelectorAll('#adminDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Show corresponding tab content
            document.querySelectorAll('#adminDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`admin${tabId.charAt(0).toUpperCase() + tabId.slice(1)}Tab`).classList.add('active');
            
            // If payment tab is clicked, hide payment form
            if (tabId === 'adminPayments') {
                document.getElementById('paymentEntryForm').style.display = 'none';
            }
        }

        // Join class (for students)
        function joinClass() {
            const meetCode = document.getElementById('meetCode').textContent;
            alert(`Joining Google Meet session with code: ${meetCode}\n\nIn a real system, this would redirect to Google Meet with the meeting code.`);
            
            // Simulate joining a class
            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(`
                    <html>
                    <head><title>Google Meet - Elite City Academy</title></head>
                    <body style="font-family: Arial, sans-serif; padding: 20px;">
                        <h1>Virtual Classroom - Elite City Academy</h1>
                        <p>Meeting Code: <strong>${meetCode}</strong></p>
                        <p>This is a simulation of Google Meet integration.</p>
                        <p>In a real implementation, this would be an actual Google Meet session.</p>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer;">Close Simulation</button>
                    </body>
                    </html>
                `);
            }
        }

        // Start class (for teachers)
        function startClass() {
            const meetCode = document.getElementById('teacherMeetCode').textContent;
            alert(`Starting Google Meet session with code: ${meetCode}\n\nShare this code with your students: ${meetCode}`);
            
            // Simulate starting a class
            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(`
                    <html>
                    <head><title>Google Meet Host - Elite City Academy</title></head>
                    <body style="font-family: Arial, sans-serif; padding: 20px;">
                        <h1>Virtual Classroom Host - Elite City Academy</h1>
                        <p>Meeting Code: <strong>${meetCode}</strong></p>
                        <p>You are the host of this meeting.</p>
                        <p>Share this code with your students: <strong>${meetCode}</strong></p>
                        <p>This is a simulation of Google Meet integration.</p>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer;">Close Simulation</button>
                    </body>
                    </html>
                `);
            }
        }

        // Schedule class (for teachers)
        function scheduleClass() {
            alert('Opening class scheduling form.\n\nIn a real system, this would allow you to schedule future classes with Google Meet.');
        }

        // Copy meet code to clipboard
        function copyMeetCode() {
            const meetCode = document.getElementById('meetCode').textContent;
            navigator.clipboard.writeText(`elite-city-${meetCode}`).then(() => {
                alert('Meeting code copied to clipboard!');
            });
        }

        // Copy teacher meet code to clipboard
        function copyTeacherMeetCode() {
            const meetCode = document.getElementById('teacherMeetCode').textContent;
            navigator.clipboard.writeText(`elite-teacher-${meetCode}`).then(() => {
                alert('Meeting code copied to clipboard!');
            });
        }

        // Send message to students (teacher function)
        function sendMessageToStudents() {
            alert('Opening SMS message composer to send message to students.\n\nIn a real system, this would integrate with an SMS gateway API.');
        }

        // Create assignment (teacher function)
        function createAssignment() {
            alert('Opening assignment creation form.\n\nIn a real system, this would allow you to create and assign tasks to students.');
        }

        // Toggle payment form visibility
        function togglePaymentForm() {
            const form = document.getElementById('paymentEntryForm');
            if (form.style.display === 'none' || form.style.display === '') {
                form.style.display = 'block';
                document.getElementById('recordPaymentBtn').textContent = 'Hide Payment Form';
                document.getElementById('recordPaymentBtn').innerHTML = '<i class="fas fa-minus-circle"></i> Hide Payment Form';
            } else {
                form.style.display = 'none';
                document.getElementById('recordPaymentBtn').textContent = 'Record Payment';
                document.getElementById('recordPaymentBtn').innerHTML = '<i class="fas fa-plus-circle"></i> Record Payment';
            }
        }

        // Save payment (admin only)
        function savePayment() {
            const studentId = parseInt(document.getElementById('paymentStudentSelect').value);
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const type = document.getElementById('paymentType').value;
            const date = document.getElementById('paymentDate').value;
            const term = document.getElementById('paymentTerm').value;
            const status = document.getElementById('paymentStatus').value;
            const description = document.getElementById('paymentDescription').value || type;
            
            if (!studentId || !amount || amount <= 0) {
                alert('Please select a student and enter a valid amount in Ghana Cedis.');
                return;
            }
            
            if (!date) {
                alert('Please select a payment date.');
                return;
            }
            
            const student = appData.students.find(s => s.id === studentId);
            if (!student) {
                alert('Student not found.');
                return;
            }
            
            const newPayment = {
                id: appData.payments.length > 0 ? Math.max(...appData.payments.map(p => p.id)) + 1 : 1,
                studentId: studentId,
                studentName: student.fullName,
                date: date,
                description: description,
                term: term,
                amount: amount,
                status: status,
                receiptNo: 'REC' + String(new Date().getFullYear()).substring(2) + String(Math.floor(1000 + Math.random() * 9000))
            };
            
            appData.payments.push(newPayment);
            
            // Update student balance if payment is marked as paid
            if (status === 'Paid') {
                student.balance = Math.max(0, (student.balance || 0) - amount);
            }
            
            saveDataToLocalStorage();
            updateAdminDashboard();
            
            // Clear form
            document.getElementById('paymentAmount').value = '';
            document.getElementById('paymentDescription').value = '';
            
            // Hide form
            togglePaymentForm();
            
            alert(`Payment of GHâ‚µ${amount} recorded for ${student.fullName}.\nReceipt No: ${newPayment.receiptNo}\nStatus: ${status}`);
        }

        // Filter payments
        function filterPayments() {
            updateAdminPaymentsTable();
        }

        // Mark payment as paid
        function markPaymentAsPaid(paymentId) {
            const payment = appData.payments.find(p => p.id === paymentId);
            if (payment) {
                payment.status = 'Paid';
                
                // Update student balance
                const student = appData.students.find(s => s.id === payment.studentId);
                if (student) {
                    student.balance = Math.max(0, (student.balance || 0) - payment.amount);
                }
                
                saveDataToLocalStorage();
                updateAdminDashboard();
                alert('Payment marked as paid.');
            }
        }

        // Delete payment
        function deletePayment(paymentId) {
            appData.payments = appData.payments.filter(p => p.id !== paymentId);
            saveDataToLocalStorage();
            updateAdminDashboard();
            alert('Payment record deleted.');
        }

        // Open user modal for adding/editing users
        function openUserModal(userType, action, userId = null) {
            const modal = document.getElementById('userModal');
            const modalTitle = document.getElementById('userModalTitle');
            const studentForm = document.getElementById('studentModalForm');
            const teacherForm = document.getElementById('teacherModalForm');
            const deleteBtn = document.getElementById('deleteUserBtn');
            
            // Set modal title
            if (action === 'add') {
                modalTitle.textContent = `Add ${userType === 'student' ? 'Student' : 'Teacher'}`;
                deleteBtn.style.display = 'none';
            } else {
                modalTitle.textContent = `Edit ${userType === 'student' ? 'Student' : 'Teacher'}`;
                deleteBtn.style.display = 'inline-block';
            }
            
            // Show appropriate form
            if (userType === 'student') {
                studentForm.style.display = 'block';
                teacherForm.style.display = 'none';
                
                // If editing, populate form with existing data
                if (action === 'edit' && userId) {
                    const student = appData.students.find(s => s.id === userId);
                    if (student) {
                        document.getElementById('modalUserId').value = student.id;
                        document.getElementById('modalUserType').value = 'student';
                        document.getElementById('modalFirstname').value = student.firstname;
                        document.getElementById('modalSurname').value = student.surname;
                        document.getElementById('modalDob').value = student.dob;
                        document.getElementById('modalClass').value = student.class;
                        document.getElementById('modalContact').value = student.contact;
                        document.getElementById('modalResidence').value = student.residence;
                        document.getElementById('modalEmail').value = student.email;
                        document.getElementById('modalParentContact').value = student.parentContact || '';
                    }
                } else {
                    // Clear form for adding
                    document.getElementById('modalUserId').value = '';
                    document.getElementById('modalUserType').value = 'student';
                    document.getElementById('userModalForm').reset();
                }
            } else {
                studentForm.style.display = 'none';
                teacherForm.style.display = 'block';
                
                // If editing, populate form with existing data
                if (action === 'edit' && userId) {
                    const teacher = appData.teachers.find(t => t.id === userId);
                    if (teacher) {
                        document.getElementById('modalUserId').value = teacher.id;
                        document.getElementById('modalUserType').value = 'teacher';
                        document.getElementById('modalTeacherName').value = teacher.name;
                        document.getElementById('modalTeacherSubject').value = teacher.subject;
                        document.getElementById('modalTeacherDob').value = teacher.dob;
                        document.getElementById('modalTeacherResidence').value = teacher.residence;
                        document.getElementById('modalTeacherContact').value = teacher.contact;
                        document.getElementById('modalTeacherSsnit').value = teacher.ssnit;
                        document.getElementById('modalTeacherQualification').value = teacher.qualification;
                        document.getElementById('modalTeacherEmail').value = teacher.email;
                    }
                } else {
                    // Clear form for adding
                    document.getElementById('modalUserId').value = '';
                    document.getElementById('modalUserType').value = 'teacher';
                    document.getElementById('userModalForm').reset();
                }
            }
            
            modal.style.display = 'flex';
        }

        // Close user modal
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        // Save user (add or edit)
        function saveUser() {
            const userId = document.getElementById('modalUserId').value;
            const userType = document.getElementById('modalUserType').value;
            const isEdit = userId !== '';
            
            if (userType === 'student') {
                const studentData = {
                    id: isEdit ? parseInt(userId) : (appData.students.length > 0 ? Math.max(...appData.students.map(s => s.id)) + 1 : 1),
                    firstname: document.getElementById('modalFirstname').value,
                    surname: document.getElementById('modalSurname').value,
                    fullName: document.getElementById('modalFirstname').value + ' ' + document.getElementById('modalSurname').value,
                    dob: document.getElementById('modalDob').value,
                    class: document.getElementById('modalClass').value,
                    contact: document.getElementById('modalContact').value,
                    residence: document.getElementById('modalResidence').value,
                    email: document.getElementById('modalEmail').value,
                    parentContact: document.getElementById('modalParentContact').value,
                    status: 'Active',
                    balance: 0
                };
                
                if (isEdit) {
                    // Update existing student
                    const index = appData.students.findIndex(s => s.id === parseInt(userId));
                    if (index !== -1) {
                        // Preserve password and balance
                        studentData.password = appData.students[index].password;
                        studentData.balance = appData.students[index].balance;
                        appData.students[index] = studentData;
                    }
                } else {
                    // Add new student with default password
                    studentData.password = 'student123';
                    appData.students.push(studentData);
                }
            } else {
                const teacherData = {
                    id: isEdit ? parseInt(userId) : (appData.teachers.length > 0 ? Math.max(...appData.teachers.map(t => t.id)) + 1 : 1),
                    name: document.getElementById('modalTeacherName').value,
                    subject: document.getElementById('modalTeacherSubject').value,
                    dob: document.getElementById('modalTeacherDob').value,
                    residence: document.getElementById('modalTeacherResidence').value,
                    contact: document.getElementById('modalTeacherContact').value,
                    ssnit: document.getElementById('modalTeacherSsnit').value,
                    qualification: document.getElementById('modalTeacherQualification').value,
                    email: document.getElementById('modalTeacherEmail').value,
                    status: 'Active'
                };
                
                if (isEdit) {
                    // Update existing teacher
                    const index = appData.teachers.findIndex(t => t.id === parseInt(userId));
                    if (index !== -1) {
                        // Preserve password
                        teacherData.password = appData.teachers[index].password;
                        appData.teachers[index] = teacherData;
                    }
                } else {
                    // Add new teacher with default password
                    teacherData.password = 'teacher123';
                    appData.teachers.push(teacherData);
                }
            }
            
            saveDataToLocalStorage();
            updateAdminDashboard();
            closeUserModal();
            
            alert(`${userType === 'student' ? 'Student' : 'Teacher'} ${isEdit ? 'updated' : 'added'} successfully!`);
        }

        // Delete user
        function deleteUser() {
            const userId = document.getElementById('modalUserId').value;
            const userType = document.getElementById('modalUserType').value;
            
            if (userType === 'student') {
                appData.students = appData.students.filter(s => s.id !== parseInt(userId));
            } else {
                appData.teachers = appData.teachers.filter(t => t.id !== parseInt(userId));
            }
            
            saveDataToLocalStorage();
            updateAdminDashboard();
            closeUserModal();
            
            alert(`${userType === 'student' ? 'Student' : 'Teacher'} deleted successfully!`);
        }

        // Delete student directly
        function deleteStudent(studentId) {
            appData.students = appData.students.filter(s => s.id !== studentId);
            saveDataToLocalStorage();
            updateAdminDashboard();
        }

        // Delete teacher directly
        function deleteTeacher(teacherId) {
            appData.teachers = appData.teachers.filter(t => t.id !== teacherId);
            saveDataToLocalStorage();
            updateAdminDashboard();
        }

        // Open gallery modal
        function openGalleryModal() {
            document.getElementById('galleryModal').style.display = 'flex';
        }

        // Close gallery modal
        function closeGalleryModal() {
            document.getElementById('galleryModal').style.display = 'none';
        }

        // Save gallery image
        function saveGalleryImage() {
            const title = document.getElementById('galleryImageTitle').value;
            const category = document.getElementById('galleryImageCategory').value;
            const description = document.getElementById('galleryImageDescription').value;
            const imageUrl = document.getElementById('galleryImageUrl').value;
            
            if (!title || !imageUrl) {
                alert('Please enter a title and image URL.');
                return;
            }
            
            const newImage = {
                id: appData.gallery.length > 0 ? Math.max(...appData.gallery.map(g => g.id)) + 1 : 1,
                title: title,
                category: category,
                description: description,
                imageUrl: imageUrl
            };
            
            appData.gallery.push(newImage);
            saveDataToLocalStorage();
            updateAdminDashboard();
            closeGalleryModal();
            
            alert('Image added to gallery successfully!');
        }

        // Delete gallery image
        function deleteGalleryImage(imageId) {
            appData.gallery = appData.gallery.filter(g => g.id !== imageId);
            saveDataToLocalStorage();
            updateAdminDashboard();
        }

        // Open event modal
        function openEventModal() {
            document.getElementById('eventModal').style.display = 'flex';
        }

        // Close event modal
        function closeEventModal() {
            document.getElementById('eventModal').style.display = 'none';
        }

        // Save event
        function saveEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            const audience = document.getElementById('eventAudience').value;
            
            if (!title || !date || !time) {
                alert('Please fill in all required fields.');
                return;
            }
            
            const newEvent = {
                id: appData.events.length > 0 ? Math.max(...appData.events.map(e => e.id)) + 1 : 1,
                title: title,
                date: date,
                time: time,
                description: description,
                audience: audience,
                status: 'Upcoming'
            };
            
            appData.events.push(newEvent);
            saveDataToLocalStorage();
            updateAdminDashboard();
            closeEventModal();
            
            alert('Event added successfully!');
        }

        // Delete event
        function deleteEvent(eventId) {
            appData.events = appData.events.filter(e => e.id !== eventId);
            saveDataToLocalStorage();
            updateAdminDashboard();
        }

        // Handle SMS recipient change
        function handleSMSRecipientChange() {
            const recipientType = document.getElementById('smsRecipient').value;
            const specificClassContainer = document.getElementById('specificClassContainer');
            const specificRecipientContainer = document.getElementById('specificRecipientContainer');
            
            if (recipientType === 'specific_class') {
                specificClassContainer.style.display = 'block';
                specificRecipientContainer.style.display = 'none';
            } else if (recipientType === 'specific') {
                specificClassContainer.style.display = 'none';
                specificRecipientContainer.style.display = 'block';
            } else {
                specificClassContainer.style.display = 'none';
                specificRecipientContainer.style.display = 'none';
            }
        }

        // Update SMS character count
        function updateSMSCharCount() {
            const message = document.getElementById('smsMessage').value;
            const charCount = message.length;
            document.getElementById('smsCharCount').textContent = charCount;
            
            // Change color if over limit
            const charCountElement = document.getElementById('smsCharCount');
            if (charCount > 160) {
                charCountElement.style.color = 'var(--danger)';
            } else {
                charCountElement.style.color = 'inherit';
            }
        }

        // Handle SMS template change
        function handleSMSTemplateChange() {
            const template = document.getElementById('smsTemplate').value;
            const messageField = document.getElementById('smsMessage');
            
            let templateMessage = '';
            
            switch(template) {
                case 'fees_reminder':
                    templateMessage = 'Dear Parent/Guardian, this is a reminder that school fees payment for Term 2 is due by 30th November. Please make payment at the accounts office. Thank you.';
                    break;
                case 'event_notification':
                    templateMessage = 'Dear Parent, there will be a Parent-Teacher Meeting on 15th December at 10 AM. Your attendance is highly encouraged.';
                    break;
                case 'assignment_reminder':
                    templateMessage = 'Dear Student, reminder: Science assignment submission deadline is tomorrow. Please ensure you submit on time.';
                    break;
                case 'emergency':
                    templateMessage = 'URGENT: School will close early today due to unforeseen circumstances. Parents are requested to pick up their children by 1 PM.';
                    break;
                case 'report_card':
                    templateMessage = 'Dear Parent, your child\'s report card for Term 1 is now available. Please log in to the portal to view it.';
                    break;
            }
            
            if (templateMessage) {
                messageField.value = templateMessage;
                updateSMSCharCount();
            }
        }

        // Send SMS
        function sendSMS() {
            const recipientType = document.getElementById('smsRecipient').value;
            const specificClass = document.getElementById('specificClass').value;
            const specificRecipient = document.getElementById('specificRecipient').value;
            const message = document.getElementById('smsMessage').value;
            
            if (!message.trim()) {
                alert('Please enter a message.');
                return;
            }
            
            if (message.length > 160) {
                alert('Message is too long. SMS messages must be 160 characters or less.');
                return;
            }
            
            // Determine recipient
            let recipient = '';
            let recipientCount = 0;
            
            if (recipientType === 'all_students') {
                recipient = 'All Students';
                recipientCount = appData.students.length;
            } else if (recipientType === 'all_teachers') {
                recipient = 'All Teachers';
                recipientCount = appData.teachers.length;
            } else if (recipientType === 'all_parents') {
                recipient = 'All Parents';
                recipientCount = appData.students.length; // Assuming each student has at least one parent
            } else if (recipientType === 'specific_class' && specificClass) {
                recipient = `${specificClass} Students`;
                recipientCount = appData.students.filter(s => s.class === specificClass).length;
            } else if (recipientType === 'specific' && specificRecipient) {
                const [type, id] = specificRecipient.split('_');
                if (type === 'student') {
                    const student = appData.students.find(s => s.id === parseInt(id));
                    recipient = student ? student.fullName : 'Specific Student';
                    recipientCount = 1;
                } else {
                    const teacher = appData.teachers.find(t => t.id === parseInt(id));
                    recipient = teacher ? teacher.name : 'Specific Teacher';
                    recipientCount = 1;
                }
            } else {
                alert('Please select a recipient.');
                return;
            }
            
            // Create SMS record
            const newSMS = {
                id: appData.smsHistory.length > 0 ? Math.max(...appData.smsHistory.map(s => s.id)) + 1 : 1,
                date: new Date().toISOString().split('T')[0],
                recipient: recipient,
                message: message,
                status: 'Delivered'
            };
            
            appData.smsHistory.unshift(newSMS); // Add to beginning
            saveDataToLocalStorage();
            updateAdminDashboard();
            
            // Update SMS credits
            const creditsElement = document.getElementById('smsCredits');
            let credits = parseInt(creditsElement.textContent);
            credits = Math.max(0, credits - recipientCount);
            creditsElement.textContent = credits;
            
            // Show success message
            alert(`SMS sent successfully to ${recipient} (${recipientCount} recipient(s))!\n\nMessage: "${message}"\n\nIn a real system, this would be sent via an SMS gateway API.`);
            
            // Clear message field
            document.getElementById('smsMessage').value = '';
            updateSMSCharCount();
        }
    </script>
</body>
</html>